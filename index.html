<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ادفيستا - ربح المال من مشاهدة الإعلانات</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
            position: relative;
            -webkit-text-size-adjust: 100%;
            touch-action: pan-y;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            min-height: 90vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(90deg, #0d47a1 0%, #311b92 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: #ffd600;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .logo span {
            color: #ffd600;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .points {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .points i {
            color: #ffd600;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid #ffd600;
            object-fit: cover;
        }
        
        .logout-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Main Content */
        .main-content {
            display: flex;
            min-height: 70vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: #f5f5f5;
            padding: 20px 0;
            border-left: 1px solid #e0e0e0;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-menu li {
            margin-bottom: 5px;
        }
        
        .nav-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            color: #333;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            border-right: 4px solid transparent;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background-color: #e3f2fd;
            border-right: 4px solid #0d47a1;
            color: #0d47a1;
        }
        
        .nav-menu i {
            width: 20px;
            text-align: center;
        }
        
        .content-area {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-title {
            font-size: 1.8rem;
            color: #0d47a1;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
            padding: 20px;
            text-align: center;
        }
        
        .login-box {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
        }
        
        .login-box h2 {
            color: #0d47a1;
            margin-bottom: 10px;
        }
        
        .login-box p {
            color: #666;
            margin-bottom: 30px;
        }
        
        #buttonDiv {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }
        
        .login-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        
        .feature {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .feature i {
            font-size: 2rem;
            color: #0d47a1;
            margin-bottom: 10px;
        }
        
        /* Dashboard */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #0d47a1 0%, #311b92 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(13, 71, 161, 0.2);
        }
        
        .stat-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #ffd600;
        }
        
        .stat-card h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-card .subtext {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .chart-container {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .chart-placeholder {
            height: 300px;
            background-color: #f5f5f5;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-weight: bold;
        }
        
        /* Ads Section */
        .ads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .ad-card {
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        
        .ad-card:hover {
            transform: translateY(-5px);
        }
        
        .ad-header {
            background: linear-gradient(90deg, #0d47a1 0%, #311b92 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .ad-title {
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .ad-points {
            background-color: #ffd600;
            color: #333;
            padding: 5px 10px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .ad-body {
            padding: 20px;
        }
        
        .ad-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .ad-timer {
            text-align: center;
            margin: 20px 0;
        }
        
        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: #0d47a1;
            margin-bottom: 10px;
        }
        
        .timer-text {
            color: #666;
            font-size: 0.9rem;
        }
        
        .ad-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, #0d47a1 0%, #311b92 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .ad-btn:hover {
            background: linear-gradient(90deg, #08306b 0%, #1a0d47 100%);
        }
        
        .ad-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* Captcha */
        .captcha-container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .captcha-code {
            font-size: 2rem;
            letter-spacing: 10px;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 15px 0;
            font-weight: bold;
            color: #0d47a1;
            font-family: monospace;
        }
        
        .captcha-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 15px;
        }
        
        /* Referral */
        .referral-box {
            background: linear-gradient(135deg, #0d47a1 0%, #311b92 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .referral-link {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.2rem;
            word-break: break-all;
            font-family: monospace;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .referral-link:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .copy-btn {
            background-color: #ffd600;
            color: #333;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .referral-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        /* Withdrawal */
        .withdrawal-form {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: #0d47a1;
            outline: none;
        }
        
        .withdrawal-info {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .withdrawal-info ul {
            padding-right: 20px;
            margin-top: 10px;
        }
        
        .withdrawal-info li {
            margin-bottom: 8px;
        }
        
        .submit-btn {
            background: linear-gradient(90deg, #0d47a1 0%, #311b92 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            background: linear-gradient(90deg, #08306b 0%, #1a0d47 100%);
        }
        
        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* Admin Panel */
        .admin-controls {
            background-color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        
        .tab-btn {
            padding: 12px 25px;
            background-color: #f5f5f5;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background-color: #0d47a1;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th, .data-table td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background-color: #f5f5f5;
            font-weight: bold;
            color: #333;
        }
        
        .data-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 0 5px;
        }
        
        .approve-btn {
            background-color: #4caf50;
            color: white;
        }
        
        .reject-btn {
            background-color: #f44336;
            color: white;
        }
        
        .edit-btn {
            background-color: #ff9800;
            color: white;
        }
        
        .delete-btn {
            background-color: #9e9e9e;
            color: white;
        }
        
        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.5s, fadeOut 0.5s 2.5s forwards;
        }
        
        @keyframes slideDown {
            from { top: -100px; }
            to { top: 20px; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; visibility: hidden; }
        }
        
        .success {
            background-color: #4caf50;
        }
        
        .error {
            background-color: #f44336;
        }
        
        .warning {
            background-color: #ff9800;
        }
        
        .info {
            background-color: #2196f3;
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-left: none;
                border-bottom: 1px solid #e0e0e0;
                padding: 10px 0;
            }
            
            .nav-menu {
                display: flex;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .nav-menu li {
                margin-bottom: 0;
                margin-left: 10px;
            }
            
            .nav-menu a {
                border-right: none;
                border-bottom: 4px solid transparent;
                white-space: nowrap;
            }
            
            .nav-menu a:hover, .nav-menu a.active {
                border-right: none;
                border-bottom: 4px solid #0d47a1;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                border-radius: 10px;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .ads-grid {
                grid-template-columns: 1fr;
            }
            
            .login-box {
                padding: 20px;
            }
        }
        
        /* Disable text selection except for specific elements */
        .selectable-text, .referral-link, .withdrawal-message {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        /* Prevent zoom */
        @media (max-width: 768px) {
            body {
                font-size: 16px;
            }
            
            input, textarea, select {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header" id="header">
            <div class="logo">
                <i class="fas fa-ad"></i>
                <h1>ادفيستا <span>Advista</span></h1>
            </div>
            <div class="user-info" id="userInfo" style="display: none;">
                <div class="points">
                    <i class="fas fa-coins"></i>
                    <span id="userPoints">0</span> نقطة
                </div>
                <img id="userAvatar" class="user-avatar" src="" alt="صورة المستخدم">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
                </button>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent" style="display: none;">
            <!-- Sidebar Navigation -->
            <div class="sidebar">
                <ul class="nav-menu">
                    <li><a href="#" onclick="showSection('dashboard')" class="active" id="navDashboard"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</a></li>
                    <li><a href="#" onclick="showSection('ads')" id="navAds"><i class="fas fa-ad"></i> تصفح الإعلانات</a></li>
                    <li><a href="#" onclick="showSection('referral')" id="navReferral"><i class="fas fa-user-friends"></i> نظام الإحالات</a></li>
                    <li><a href="#" onclick="showSection('withdrawal')" id="navWithdrawal"><i class="fas fa-money-bill-wave"></i> السحب</a></li>
                    <li><a href="#" onclick="showSection('admin')" id="navAdmin" style="display: none;"><i class="fas fa-user-shield"></i> لوحة الأدمن</a></li>
                </ul>
            </div>
            
            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Section -->
                <div class="section active" id="dashboardSection">
                    <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> لوحة التحكم</h2>
                    
                    <div class="stats-cards">
                        <div class="stat-card">
                            <i class="fas fa-coins"></i>
                            <h3>رصيدك الحالي</h3>
                            <div class="value" id="currentBalance">0 نقطة</div>
                            <div class="subtext">$<span id="balanceDollars">0.00</span> دولار</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-chart-line"></i>
                            <h3>أرباح اليوم</h3>
                            <div class="value" id="todayEarnings">0 نقطة</div>
                            <div class="subtext">من <span id="todayAds">0</span> إعلان</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-trophy"></i>
                            <h3>إجمالي الأرباح</h3>
                            <div class="value" id="totalEarnings">0 نقطة</div>
                            <div class="subtext">$<span id="totalDollars">0.00</span> دولار</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <h3>الإحالات</h3>
                            <div class="value" id="referralCount">0</div>
                            <div class="subtext">ربحت منهم <span id="referralEarnings">0</span> نقطة</div>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>إحصائيات النقرات خلال الأسبوع</h3>
                        <div class="chart-placeholder" id="clicksChart">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-bar" style="font-size: 4rem; color: #ddd; margin-bottom: 15px;"></i>
                                <p>سيظهر الرسم البياني هنا</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Ads Section -->
                <div class="section" id="adsSection">
                    <h2 class="section-title"><i class="fas fa-ad"></i> تصفح الإعلانات</h2>
                    
                    <div id="adsContainer" class="ads-grid">
                        <!-- Ads will be loaded here -->
                    </div>
                    
                    <!-- Ad Timer Modal -->
                    <div id="adTimerModal" style="display: none;">
                        <div class="ad-card" style="max-width: 500px; margin: 0 auto;">
                            <div class="ad-header">
                                <div class="ad-title" id="adModalTitle">إعلان</div>
                                <div class="ad-points" id="adModalPoints">0 نقطة</div>
                            </div>
                            <div class="ad-body">
                                <p id="adModalDescription" class="ad-description">وصف الإعلان</p>
                                
                                <div class="ad-timer">
                                    <div class="timer-display" id="timerDisplay">30</div>
                                    <div class="timer-text" id="timerText">ثانية متبقية</div>
                                </div>
                                
                                <p style="color: #f44336; text-align: center; margin: 15px 0; font-weight: bold;">
                                    <i class="fas fa-exclamation-triangle"></i> إذا خرجت قبل انتهاء العداد سيتم خصم 5 نقاط!
                                </p>
                                
                                <button class="ad-btn" onclick="startAdTimer()" id="startTimerBtn">
                                    <i class="fas fa-play"></i> بدء مشاهدة الإعلان
                                </button>
                                
                                <div id="captchaContainer" class="captcha-container" style="display: none;">
                                    <h4>التحقق من أنك لست روبوت</h4>
                                    <p>أدخل الكود الظاهر بالأسفل:</p>
                                    <div class="captcha-code" id="captchaCode">A3B8</div>
                                    <input type="text" class="captcha-input" id="captchaInput" placeholder="أدخل الكود هنا" maxlength="4">
                                    <button class="ad-btn" onclick="verifyCaptcha()" id="verifyCaptchaBtn">
                                        <i class="fas fa-check"></i> تأكيد
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Referral Section -->
                <div class="section" id="referralSection">
                    <h2 class="section-title"><i class="fas fa-user-friends"></i> نظام الإحالات</h2>
                    
                    <div class="referral-box">
                        <h3>اربح 10% من أرباح كل شخص تدعوه!</h3>
                        <p>شارك رابط الإحالة الخاص بك واربح نقاط من كل إعلان يشاهده أصدقائك.</p>
                        
                        <div class="referral-link selectable-text" id="referralLink">
                            https://advista.com/ref?code=loading...
                        </div>
                        
                        <button class="copy-btn" onclick="copyReferralLink()">
                            <i class="far fa-copy"></i> نسخ رابط الإحالة
                        </button>
                    </div>
                    
                    <div class="referral-stats">
                        <div class="stat-card">
                            <i class="fas fa-user-plus"></i>
                            <h3>عدد الإحالات</h3>
                            <div class="value" id="totalReferrals">0</div>
                            <div class="subtext">أشخاص دعوتهم</div>
                        </div>
                        
                        <div class="stat-card">
                            <i class="fas fa-money-bill"></i>
                            <h3>أرباح الإحالات</h3>
                            <div class="value" id="referralProfit">0 نقطة</div>
                            <div class="subtext">$<span id="referralProfitDollars">0.00</span> دولار</div>
                        </div>
                    </div>
                </div>
                
                <!-- Withdrawal Section -->
                <div class="section" id="withdrawalSection">
                    <h2 class="section-title"><i class="fas fa-money-bill-wave"></i> طلبات السحب</h2>
                    
                    <div class="withdrawal-info">
                        <h3><i class="fas fa-info-circle"></i> معلومات السحب</h3>
                        <ul>
                            <li>الحد الأدنى للسحب: <strong>30,000 نقطة</strong> ($1 دولار)</li>
                            <li>عمولة السحب: <strong>0%</strong> (لا توجد عمولة)</li>
                            <li>طريقة السحب: <strong>فودافون كاش</strong> فقط</li>
                            <li>مدة المعالجة: <strong>24-48 ساعة</strong> بعد الموافقة</li>
                            <li>سيتم مراجعة طلبك من قبل الأدمن قبل التحويل</li>
                        </ul>
                    </div>
                    
                    <div class="withdrawal-form">
                        <div class="form-group">
                            <label for="withdrawalAmount"><i class="fas fa-coins"></i> عدد النقاط المراد سحبها</label>
                            <input type="number" class="form-control" id="withdrawalAmount" min="30000" max="1000000" placeholder="أدخل عدد النقاط (الحد الأدنى 30,000)">
                            <small style="color: #666;">الحد الأدنى 30,000 نقطة ($1 دولار)</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="vodafoneNumber"><i class="fas fa-mobile-alt"></i> رقم فودافون كاش</label>
                            <input type="text" class="form-control" id="vodafoneNumber" placeholder="أدخل رقم فودافون كاش (مثال: 01012345678)">
                        </div>
                        
                        <div class="form-group">
                            <label for="withdrawalMessage"><i class="fas fa-envelope"></i> رسالة (اختياري)</label>
                            <textarea class="form-control selectable-text" id="withdrawalMessage" rows="3" placeholder="يمكنك إضافة رسالة للأدمن إذا أردت"></textarea>
                        </div>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="font-weight: bold; margin-bottom: 10px;">المبلغ المستحق: $<span id="withdrawalDollars">0.00</span> دولار</div>
                            <div style="color: #f44336; font-weight: bold;" id="withdrawalError"></div>
                        </div>
                        
                        <button class="submit-btn" onclick="submitWithdrawal()" id="submitWithdrawalBtn">
                            <i class="fas fa-paper-plane"></i> إرسال طلب السحب
                        </button>
                    </div>
                </div>
                
                <!-- Admin Section -->
                <div class="section" id="adminSection">
                    <h2 class="section-title"><i class="fas fa-user-shield"></i> لوحة الأدمن</h2>
                    
                    <div class="admin-controls">
                        <div class="tabs">
                            <button class="tab-btn active" onclick="showAdminTab('ads')">إدارة الإعلانات</button>
                            <button class="tab-btn" onclick="showAdminTab('withdrawals')">طلبات السحب</button>
                            <button class="tab-btn" onclick="showAdminTab('users')">المستخدمين</button>
                            <button class="tab-btn" onclick="showAdminTab('createAd')">إنشاء إعلان</button>
                        </div>
                        
                        <!-- Manage Ads Tab -->
                        <div class="tab-content active" id="adminAdsTab">
                            <h3>الإعلانات المنشورة</h3>
                            <button class="action-btn approve-btn" onclick="loadAds()">
                                <i class="fas fa-sync-alt"></i> تحديث القائمة
                            </button>
                            
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>العنوان</th>
                                            <th>النقاط</th>
                                            <th>الوقت</th>
                                            <th>التاريخ</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminAdsList">
                                        <!-- Ads will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Withdrawal Requests Tab -->
                        <div class="tab-content" id="adminWithdrawalsTab">
                            <h3>طلبات السحب المعلقة</h3>
                            
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>المستخدم</th>
                                            <th>النقاط</th>
                                            <th>رقم فودافون</th>
                                            <th>التاريخ</th>
                                            <th>الحالة</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminWithdrawalsList">
                                        <!-- Withdrawals will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Users Tab -->
                        <div class="tab-content" id="adminUsersTab">
                            <h3>المستخدمين المسجلين</h3>
                            
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>الاسم</th>
                                            <th>البريد</th>
                                            <th>النقاط</th>
                                            <th>الإحالات</th>
                                            <th>تاريخ التسجيل</th>
                                        </tr>
                                    </thead>
                                    <tbody id="adminUsersList">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Create Ad Tab -->
                        <div class="tab-content" id="adminCreateAdTab">
                            <h3>إنشاء إعلان جديد</h3>
                            
                            <div class="form-group">
                                <label for="adTitle">عنوان الإعلان</label>
                                <input type="text" class="form-control" id="adTitle" placeholder="أدخل عنوان الإعلان">
                            </div>
                            
                            <div class="form-group">
                                <label for="adDescription">وصف الإعلان</label>
                                <textarea class="form-control" id="adDescription" rows="4" placeholder="أدخل وصف الإعلان"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="adLink">رابط الإعلان</label>
                                <input type="url" class="form-control" id="adLink" placeholder="https://example.com" value="https://linkjust.com/xbTIX">
                            </div>
                            
                            <div class="form-group">
                                <label for="adPoints">عدد النقاط</label>
                                <input type="number" class="form-control" id="adPoints" min="1" max="1000" value="10">
                            </div>
                            
                            <div class="form-group">
                                <label for="adTime">مدة المشاهدة (ثانية)</label>
                                <input type="number" class="form-control" id="adTime" min="10" max="120" value="30">
                            </div>
                            
                            <div class="form-group">
                                <label for="adCount">عدد مرات المشاهدة المتاحة</label>
                                <input type="number" class="form-control" id="adCount" min="1" max="10000" value="100">
                            </div>
                            
                            <button class="submit-btn" onclick="createAd()">
                                <i class="fas fa-plus-circle"></i> نشر الإعلان
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Login Section -->
        <div class="login-container" id="loginSection">
            <div class="login-box">
                <h2>مرحباً بك في <span style="color: #0d47a1;">ادفيستا</span></h2>
                <p>موقع ربح الأموال من مشاهدة الإعلانات</p>
                
                <div id="buttonDiv"></div>
                
                <div style="margin-top: 30px; color: #666;">
                    <p><i class="fas fa-check-circle" style="color: #4caf50;"></i> سجل الدخول باستخدام حساب جوجل للبدء</p>
                </div>
            </div>
            
            <div class="login-features">
                <div class="feature">
                    <i class="fas fa-ad"></i>
                    <h3>شاهد الإعلانات</h3>
                    <p>اربح النقاط بمشاهدة الإعلانات</p>
                </div>
                
                <div class="feature">
                    <i class="fas fa-user-friends"></i>
                    <h3>دعوة الأصدقاء</h3>
                    <p>اربح 10% من أرباح أحالتك</p>
                </div>
                
                <div class="feature">
                    <i class="fas fa-money-bill-wave"></i>
                    <h3>السحب السريع</h3>
                    <p>اسحب أرباحك عبر فودافون كاش</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notifications -->
    <div id="notificationArea"></div>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4fZQ-BTUeHsN9nQtMGmnjJz-NKdcUgkc",
            authDomain: "advista-b64ab.firebaseapp.com",
            projectId: "advista-b64ab",
            storageBucket: "advista-b64ab.firebasestorage.app",
            messagingSenderId: "509713648189",
            appId: "1:509713648189:web:0ccd6ada1f4e07f85d3854",
            measurementId: "G-VG4S1SMKH8"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Global Variables
        let currentUser = null;
        let userData = null;
        let currentAd = null;
        let adTimer = null;
        let adTimeLeft = 30;
        let adTimerStarted = false;
        let captchaCode = "";
        
        // Google Sign-In Initialization
        function initializeGoogleSignIn() {
            if (typeof google === 'undefined') {
                setTimeout(initializeGoogleSignIn, 100);
                return;
            }
            
            google.accounts.id.initialize({
                client_id: "805966277330-9j5j1nvluj69f8uieog0kk77p0jb46q4.apps.googleusercontent.com",
                callback: handleCredentialResponse,
                auto_select: false,
                cancel_on_tap_outside: true,
                context: "signin"
            });
            
            // Display Google Sign-In button
            google.accounts.id.renderButton(
                document.getElementById("buttonDiv"),
                { 
                    theme: "filled_blue", 
                    size: "large",
                    text: "signin_with",
                    shape: "rectangular",
                    width: "250",
                    locale: "ar",
                    logo_alignment: "left"
                }
            );
            
            google.accounts.id.prompt();
        }
        
        // Handle Google Sign-In Response
        async function handleCredentialResponse(response) {
            try {
                showNotification("جاري تسجيل الدخول...", "info");
                
                // Decode JWT token
                const googleUserData = parseJwt(response.credential);

                
                // Sign in with Firebase
                const credential = firebase.auth.GoogleAuthProvider.credential(response.credential);
                const firebaseUser = await auth.signInWithCredential(credential);
                
                // Check if user exists in Firestore
                const userDoc = await db.collection("users").doc(firebaseUser.user.uid).get();
                
                if (!userDoc.exists) {
                    // Create new user
                    const newUser = {
                        uid: firebaseUser.user.uid,
                        name: userData.name,
                        email: userData.email,
                        avatar: userData.picture,
                        points: 0,
                        totalEarned: 0,
                        todayEarnings: 0,
                        todayAds: 0,
                        referralCode: generateReferralCode(),
                        referralCount: 0,
                        referralEarnings: 0,
                        membership: "free",
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        weeklyClicks: [0, 0, 0, 0, 0, 0, 0] // 7 days
                    };
                    
                    await db.collection("users").doc(firebaseUser.user.uid).set(newUser);
                    userData = newUser;
                    
                    showNotification("مرحباً بك في Advista! لقد حصلت على 100 نقطة هدية!", "success");
                    
                    // Add bonus points for new user
                    await db.collection("users").doc(firebaseUser.user.uid).update({
                        points: firebase.firestore.FieldValue.increment(100),
                        totalEarned: firebase.firestore.FieldValue.increment(100)
                    });
                } else {
                    userData = userDoc.data();
                    
                    // Update last login
                    await db.collection("users").doc(firebaseUser.user.uid).update({
                        lastLogin: new Date().toISOString()
                    });
                }
                
                // Redirect to dashboard
                currentUser = firebaseUser.user;
                initializeApp();
                
            } catch (error) {
                console.error("Error during Google Sign-In:", error);
                showNotification("حدث خطأ أثناء تسجيل الدخول. حاول مرة أخرى.", "error");
            }
        }
        
        // Parse JWT Token
        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                
                return JSON.parse(jsonPayload);
            } catch (error) {
                console.error("JWT Error:", error);
                return null;
            }
        }
        
        // Generate Referral Code
        function generateReferralCode() {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            let code = "";
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        // Initialize App After Login
        function initializeApp() {
            // Hide login section, show main content
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("mainContent").style.display = "flex";
            document.getElementById("header").style.display = "flex";
            document.getElementById("userInfo").style.display = "flex";
            
            // Load user data
            loadUserData();
            
            // Check if user is admin
            if (currentUser.email === "bo2584668@gmail.com") {
                document.getElementById("navAdmin").style.display = "block";
                document.getElementById("adminSection").style.display = "block";
            }
            
            // Load ads
            loadAdsForUser();
        }
        
        // Load User Data
        async function loadUserData() {
            try {
                const userDoc = await db.collection("users").doc(currentUser.uid).get();
                if (userDoc.exists) {
                    userData = userDoc.data();
                    
                    // Update UI
                    document.getElementById("userPoints").textContent = userData.points;
                    document.getElementById("userAvatar").src = userData.avatar || "https://ui-avatars.com/api/?name=" + encodeURIComponent(userData.name) + "&background=0d47a1&color=fff";
                    
                    // Dashboard stats
                    document.getElementById("currentBalance").textContent = userData.points + " نقطة";
                    document.getElementById("balanceDollars").textContent = (userData.points / 30000).toFixed(2);
                    
                    document.getElementById("todayEarnings").textContent = (userData.todayEarnings || 0) + " نقطة";
                    document.getElementById("todayAds").textContent = userData.todayAds || 0;
                    
                    document.getElementById("totalEarnings").textContent = userData.totalEarned + " نقطة";
                    document.getElementById("totalDollars").textContent = (userData.totalEarned / 30000).toFixed(2);
                    
                    document.getElementById("referralCount").textContent = userData.referralCount || 0;
                    document.getElementById("referralEarnings").textContent = userData.referralEarnings || 0;
                    
                    // Referral section
                    document.getElementById("referralLink").textContent = window.location.origin + "?ref=" + userData.referralCode;
                    document.getElementById("totalReferrals").textContent = userData.referralCount || 0;
                    document.getElementById("referralProfit").textContent = userData.referralEarnings || 0 + " نقطة";
                    document.getElementById("referralProfitDollars").textContent = ((userData.referralEarnings || 0) / 30000).toFixed(2);
                    
                    // Withdrawal section
                    document.getElementById("withdrawalAmount").addEventListener("input", function() {
                        const points = parseInt(this.value) || 0;
                        document.getElementById("withdrawalDollars").textContent = (points / 30000).toFixed(2);
                        
                        if (points < 30000) {
                            document.getElementById("withdrawalError").textContent = "الحد الأدنى للسحب هو 30,000 نقطة";
                            document.getElementById("submitWithdrawalBtn").disabled = true;
                        } else if (points > userData.points) {
                            document.getElementById("withdrawalError").textContent = "ليس لديك نقاط كافية";
                            document.getElementById("submitWithdrawalBtn").disabled = true;
                        } else {
                            document.getElementById("withdrawalError").textContent = "";
                            document.getElementById("submitWithdrawalBtn").disabled = false;
                        }
                    });
                }
            } catch (error) {
                console.error("Error loading user data:", error);
            }
        }
        
        // Load Ads for User
        async function loadAdsForUser() {
            try {
                const adsSnapshot = await db.collection("ads").where("active", "==", true).limit(20).get();
                const adsContainer = document.getElementById("adsContainer");
                adsContainer.innerHTML = "";
                
                if (adsSnapshot.empty) {
                    adsContainer.innerHTML = `
                        <div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #666;">
                            <i class="fas fa-ad" style="font-size: 4rem; color: #ddd; margin-bottom: 15px;"></i>
                            <h3>لا توجد إعلانات متاحة حالياً</h3>
                            <p>عد لاحقاً لمشاهدة إعلانات جديدة</p>
                        </div>
                    `;
                    return;
                }
                
                let adIndex = 1;
                adsSnapshot.forEach(doc => {
                    const ad = doc.data();
                    ad.id = doc.id;
                    
                    // Check if user already viewed this ad today
                    const today = new Date().toDateString();
                    const viewedAds = userData.viewedAds || {};
                    
                    if (viewedAds[today] && viewedAds[today].includes(ad.id)) {
                        return; // Skip already viewed ads
                    }
                    
                    const adCard = document.createElement("div");
                    adCard.className = "ad-card";
                    adCard.innerHTML = `
                        <div class="ad-header">
                            <div class="ad-title">${ad.title}</div>
                            <div class="ad-points">${ad.points} نقطة</div>
                        </div>
                        <div class="ad-body">
                            <p class="ad-description">${ad.description}</p>
                            <div style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                                <i class="far fa-clock"></i> ${ad.time} ثانية
                            </div>
                            <button class="ad-btn" onclick="viewAd('${ad.id}')">
                                <i class="fas fa-play"></i> مشاهدة الإعلان
                            </button>
                        </div>
                    `;
                    
                    adsContainer.appendChild(adCard);
                    adIndex++;
                });
                
                // If no ads available (all already viewed)
                if (adIndex === 1) {
                    adsContainer.innerHTML = `
                        <div style="text-align: center; grid-column: 1/-1; padding: 40px; color: #666;">
                            <i class="fas fa-check-circle" style="font-size: 4rem; color: #4caf50; margin-bottom: 15px;"></i>
                            <h3>لقد شاهدت كل الإعلانات المتاحة اليوم</h3>
                            <p>عد غداً لمشاهدة إعلانات جديدة</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error("Error loading ads:", error);
                showNotification("حدث خطأ أثناء تحميل الإعلانات", "error");
            }
        }
        
        // View Ad
        async function viewAd(adId) {
            try {
                const adDoc = await db.collection("ads").doc(adId).get();
                if (!adDoc.exists) {
                    showNotification("هذا الإعلان لم يعد متاحاً", "error");
                    return;
                }
            
                currentAd = adDoc.data();
                currentAd.id = adId;
                adTimeLeft = currentAd.time || 30;
                adTimerStarted = false;
                
                // Show ad timer modal
                document.getElementById("adsContainer").style.display = "none";
                document.getElementById("adTimerModal").style.display = "block";
                
                document.getElementById("adModalTitle").textContent = currentAd.title;
                document.getElementById("adModalPoints").textContent = currentAd.points + " نقطة";
                document.getElementById("adModalDescription").textContent = currentAd.description;
                document.getElementById("timerDisplay").textContent = adTimeLeft;
                document.getElementById("timerText").textContent = "ثانية متبقية";
                document.getElementById("startTimerBtn").disabled = false;
                document.getElementById("startTimerBtn").innerHTML = '<i class="fas fa-play"></i> بدء مشاهدة الإعلان';
                document.getElementById("captchaContainer").style.display = "none";
                
            } catch (error) {
                console.error("Error viewing ad:", error);
                showNotification("حدث خطأ أثناء تحميل الإعلان", "error");
            }
        }
        
        // Start Ad Timer
        function startAdTimer() {
            if (adTimerStarted) return;
            
            adTimerStarted = true;
            document.getElementById("startTimerBtn").disabled = true;
            document.getElementById("startTimerBtn").innerHTML = '<i class="fas fa-play"></i> جاري العرض...';
            
            // Start countdown
            adTimer = setInterval(() => {
                adTimeLeft--;
                document.getElementById("timerDisplay").textContent = adTimeLeft;
                
                if (adTimeLeft <= 0) {
                    clearInterval(adTimer);
                    showCaptcha();
                }
            }, 1000);
        }
        
        // Show Captcha
        function showCaptcha() {
            document.getElementById("timerText").textContent = "تم انتهاء الوقت!";
            document.getElementById("captchaContainer").style.display = "block";
            
            // Generate random captcha
            captchaCode = generateCaptcha();
            document.getElementById("captchaCode").textContent = captchaCode;
        }
        
        // Generate Captcha
        function generateCaptcha() {
            const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
            let code = "";
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        // Verify Captcha
        async function verifyCaptcha() {
            const userInput = document.getElementById("captchaInput").value.toUpperCase();
            const verifyBtn = document.getElementById("verifyCaptchaBtn");
            
            if (userInput !== captchaCode) {
                showNotification("كود التحقق غير صحيح. حاول مرة أخرى.", "error");
                captchaCode = generateCaptcha();
                document.getElementById("captchaCode").textContent = captchaCode;
                document.getElementById("captchaInput").value = "";
                return;
            }
            
            // Captcha is correct, award points
            verifyBtn.disabled = true;
            verifyBtn.innerHTML = '<div class="loading"></div> جاري المعالجة...';
            
            try {
                const today = new Date().toDateString();
                const viewedAds = userData.viewedAds || {};
                
                if (!viewedAds[today]) {
                    viewedAds[today] = [];
                }
                
                // Add ad to viewed ads
                viewedAds[today].push(currentAd.id);
                
                // Update user points
                await db.collection("users").doc(currentUser.uid).update({
                    points: firebase.firestore.FieldValue.increment(currentAd.points),
                    totalEarned: firebase.firestore.FieldValue.increment(currentAd.points),
                    todayEarnings: firebase.firestore.FieldValue.increment(currentAd.points),
                    todayAds: firebase.firestore.FieldValue.increment(1),
                    viewedAds: viewedAds
                });
                
                // Update weekly clicks
                const dayOfWeek = new Date().getDay(); // 0 = Sunday, 1 = Monday, etc.
                const weeklyClicks = userData.weeklyClicks || [0, 0, 0, 0, 0, 0, 0];
                weeklyClicks[dayOfWeek] = (weeklyClicks[dayOfWeek] || 0) + 1;
                
                await db.collection("users").doc(currentUser.uid).update({
                    weeklyClicks: weeklyClicks
                });
                
                // Update ad views count
                await db.collection("ads").doc(currentAd.id).update({
                    views: firebase.firestore.FieldValue.increment(1)
                });
                
                // Show success message
                showNotification(`مبروك! لقد ربحت ${currentAd.points} نقطة!`, "success");
                
                // Reset and go back to ads
                setTimeout(() => {
                    document.getElementById("adTimerModal").style.display = "none";
                    document.getElementById("adsContainer").style.display = "grid";
                    loadUserData();
                    loadAdsForUser();
                }, 2000);
                
            } catch (error) {
                console.error("Error awarding points:", error);
                showNotification("حدث خطأ أثناء معالجة النقاط", "error");
            }
        }
        
        // Handle page visibility change (user leaving the page)
        document.addEventListener("visibilitychange", function() {
            if (adTimerStarted && document.hidden) {
                // User left the page during ad view
                if (adTimeLeft > 0) {
                    // Penalize user with 5 points deduction
                    deductPointsForLeaving();
                }
            }
        });
        
        // Deduct points for leaving ad early
        async function deductPointsForLeaving() {
            if (!adTimerStarted || adTimeLeft <= 0) return;
            
            try {
                await db.collection("users").doc(currentUser.uid).update({
                    points: firebase.firestore.FieldValue.increment(-5)
                });
                
                showNotification("تم خصم 5 نقاط لمغادرتك الإعلان قبل انتهاء الوقت!", "warning");
                
                // Reset ad view
                clearInterval(adTimer);
                document.getElementById("adTimerModal").style.display = "none";
                document.getElementById("adsContainer").style.display = "grid";
                loadUserData();
                
            } catch (error) {
                console.error("Error deducting points:", error);
            }
        }
        
        // Show Section
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll(".section");
            sections.forEach(section => {
                section.classList.remove("active");
            });
            
            // Remove active class from all nav items
            const navItems = document.querySelectorAll(".nav-menu a");
            navItems.forEach(item => {
                item.classList.remove("active");
            });
            
            // Show selected section
            document.getElementById(sectionId + "Section").classList.add("active");
            
            // Activate corresponding nav item
            document.getElementById("nav" + sectionId.charAt(0).toUpperCase() + sectionId.slice(1)).classList.add("active");
            
            // Load data for section
            if (sectionId === "dashboard") {
                loadUserData();
            } else if (sectionId === "ads") {
                loadAdsForUser();
            } else if (sectionId === "admin") {
                loadAdminData();
            }
        }
        
        // Copy Referral Link
        function copyReferralLink() {
            const link = document.getElementById("referralLink").textContent;
            navigator.clipboard.writeText(link).then(() => {
                showNotification("تم نسخ رابط الإحالة بنجاح!", "success");
            });
        }
        
        // Submit Withdrawal Request
        async function submitWithdrawal() {
            const points = parseInt(document.getElementById("withdrawalAmount").value);
            const vodafoneNumber = document.getElementById("vodafoneNumber").value;
            const message = document.getElementById("withdrawalMessage").value;
            
            if (!points || points < 30000) {
                showNotification("الحد الأدنى للسحب هو 30,000 نقطة", "error");
                return;
            }
            
            if (!vodafoneNumber || vodafoneNumber.length < 10) {
                showNotification("يرجى إدخال رقم فودافون كاش صحيح", "error");
                return;
            }
            
            if (points > userData.points) {
                showNotification("ليس لديك نقاط كافية للسحب", "error");
                return;
            }
            
            const btn = document.getElementById("submitWithdrawalBtn");
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> جاري المعالجة...';
            
            try {
                // Create withdrawal request
                const withdrawalData = {
                    userId: currentUser.uid,
                    userName: userData.name,
                    userEmail: userData.email,
                    points: points,
                    amountDollars: points / 30000,
                    vodafoneNumber: vodafoneNumber,
                    message: message,
                    status: "pending", // pending, approved, rejected, completed
                    createdAt: new Date().toISOString(),
                    adminNote: ""
                };
                
                await db.collection("withdrawals").add(withdrawalData);
                
                // Deduct points from user
                await db.collection("users").doc(currentUser.uid).update({
                    points: firebase.firestore.FieldValue.increment(-points)
                });
                
                showNotification("تم إرسال طلب السحب بنجاح! سيتم مراجعته من قبل الأدمن.", "success");
                
                // Reset form
                document.getElementById("withdrawalAmount").value = "";
                document.getElementById("vodafoneNumber").value = "";
                document.getElementById("withdrawalMessage").value = "";
                document.getElementById("withdrawalDollars").textContent = "0.00";
                
                // Reload user data
                loadUserData();
                
            } catch (error) {
                console.error("Error submitting withdrawal:", error);
                showNotification("حدث خطأ أثناء إرسال طلب السحب", "error");
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> إرسال طلب السحب';
            }
        }
        
        // Admin Functions
        function showAdminTab(tabId) {
            // Hide all tabs
            const tabs = document.querySelectorAll(".tab-content");
            tabs.forEach(tab => {
                tab.classList.remove("active");
            });
            
            // Remove active class from all tab buttons
            const tabBtns = document.querySelectorAll(".tab-btn");
            tabBtns.forEach(btn => {
                btn.classList.remove("active");
            });
            
            // Show selected tab
            document.getElementById("admin" + tabId.charAt(0).toUpperCase() + tabId.slice(1) + "Tab").classList.add("active");
            
            // Activate button
            event.target.classList.add("active");
            
            // Load tab data
            if (tabId === "ads") {
                loadAds();
            } else if (tabId === "withdrawals") {
                loadWithdrawals();
            } else if (tabId === "users") {
                loadUsers();
            }
        }
        
        // Load Admin Ads
        async function loadAds() {
            try {
                const adsSnapshot = await db.collection("ads").orderBy("createdAt", "desc").limit(50).get();
                const adsList = document.getElementById("adminAdsList");
                adsList.innerHTML = "";
                
                if (adsSnapshot.empty) {
                    adsList.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 20px;">لا توجد إعلانات</td></tr>`;
                    return;
                }
                
                let index = 1;
                adsSnapshot.forEach(doc => {
                    const ad = doc.data();
                    ad.id = doc.id;
                    
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${index}</td>
                        <td>${ad.title}</td>
                        <td>${ad.points}</td>
                        <td>${ad.time} ثانية</td>
                        <td>${new Date(ad.createdAt).toLocaleDateString("ar-EG")}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editAd('${ad.id}')"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn" onclick="deleteAd('${ad.id}')"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                    
                    adsList.appendChild(row);
                    index++;
                });
                
            } catch (error) {
                console.error("Error loading ads for admin:", error);
            }
        }
        
        // Load Withdrawals for Admin
        async function loadWithdrawals() {
            try {
                const withdrawalsSnapshot = await db.collection("withdrawals").where("status", "==", "pending").orderBy("createdAt", "desc").limit(50).get();
                const withdrawalsList = document.getElementById("adminWithdrawalsList");
                withdrawalsList.innerHTML = "";
                
                if (withdrawalsSnapshot.empty) {
                    withdrawalsList.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 20px;">لا توجد طلبات سحب معلقة</td></tr>`;
                    return;
                }
                
                let index = 1;
                withdrawalsSnapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    withdrawal.id = doc.id;
                    
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${index}</td>
                        <td>${withdrawal.userName}</td>
                        <td>${withdrawal.points} نقطة</td>
                        <td>${withdrawal.vodafoneNumber}</td>
                        <td>${new Date(withdrawal.createdAt).toLocaleDateString("ar-EG")}</td>
                        <td><span style="color: #ff9800; font-weight: bold;">معلق</span></td>
                        <td>
                            <button class="action-btn approve-btn" onclick="approveWithdrawal('${withdrawal.id}', '${withdrawal.userId}', ${withdrawal.points}, '${withdrawal.vodafoneNumber}')"><i class="fas fa-check"></i> قبول</button>
                            <button class="action-btn reject-btn" onclick="rejectWithdrawal('${withdrawal.id}')"><i class="fas fa-times"></i> رفض</button>
                        </td>
                    `;
                    
                    withdrawalsList.appendChild(row);
                    index++;
                });
                
            } catch (error) {
                console.error("Error loading withdrawals:", error);
            }
        }
        
        // Load Users for Admin
        async function loadUsers() {
            try {
                const usersSnapshot = await db.collection("users").orderBy("createdAt", "desc").limit(50).get();
                const usersList = document.getElementById("adminUsersList");
                usersList.innerHTML = "";
                
                if (usersSnapshot.empty) {
                    usersList.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 20px;">لا يوجد مستخدمين</td></tr>`;
                    return;
                }
                
                let index = 1;
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    user.id = doc.id;
                    
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${index}</td>
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.points} نقطة</td>
                        <td>${user.referralCount || 0}</td>
                        <td>${new Date(user.createdAt).toLocaleDateString("ar-EG")}</td>
                    `;
                    
                    usersList.appendChild(row);
                    index++;
                });
                
            } catch (error) {
                console.error("Error loading users:", error);
            }
        }
        
        // Create Ad
        async function createAd() {
            const title = document.getElementById("adTitle").value;
            const description = document.getElementById("adDescription").value;
            const link = document.getElementById("adLink").value;
            const points = parseInt(document.getElementById("adPoints").value);
            const time = parseInt(document.getElementById("adTime").value);
            const count = parseInt(document.getElementById("adCount").value);
            
            if (!title || !description || !link || !points || !time || !count) {
                showNotification("يرجى ملء جميع الحقول", "error");
                return;
            }
            
            try {
                const adData = {
                    title: title,
                    description: description,
                    link: link,
                    points: points,
                    time: time,
                    count: count,
                    views: 0,
                    active: true,
                    createdAt: new Date().toISOString()
                };
                
                await db.collection("ads").add(adData);
                
                showNotification("تم نشر الإعلان بنجاح!", "success");
                
                // Clear form
                document.getElementById("adTitle").value = "";
                document.getElementById("adDescription").value = "";
                document.getElementById("adLink").value = "https://linkjust.com/xbTIX";
                document.getElementById("adPoints").value = "10";
                document.getElementById("adTime").value = "30";
                document.getElementById("adCount").value = "100";
                
                // Reload ads
                loadAds();
                
            } catch (error) {
                console.error("Error creating ad:", error);
                showNotification("حدث خطأ أثناء نشر الإعلان", "error");
            }
        }
        
        // Edit Ad
        function editAd(adId) {
            showNotification("هذه الميزة تحت التطوير", "info");
        }
        
        // Delete Ad
        async function deleteAd(adId) {
            if (!confirm("هل أنت متأكد من حذف هذا الإعلان؟")) {
                return;
            }
            
            try {
                await db.collection("ads").doc(adId).delete();
                showNotification("تم حذف الإعلان بنجاح", "success");
                loadAds();
            } catch (error) {
                console.error("Error deleting ad:", error);
                showNotification("حدث خطأ أثناء حذف الإعلان", "error");
            }
        }
        
        // Approve Withdrawal
        async function approveWithdrawal(withdrawalId, userId, points, vodafoneNumber) {
            if (!confirm("هل أنت متأكد من الموافقة على طلب السحب هذا؟ سيتم خصم النقاط من رصيد المستخدم.")) {
                return;
            }
            
            try {
                // Update withdrawal status
                await db.collection("withdrawals").doc(withdrawalId).update({
                    status: "approved",
                    approvedAt: new Date().toISOString(),
                    adminNote: "تمت الموافقة على الطلب، جاري التحويل إلى فودافون كاش"
                });
                
                showNotification("تمت الموافقة على طلب السحب! تذكر تحويل المبلغ إلى رقم فودافون: " + vodafoneNumber, "success");
                
                // Send notification to admin email (in a real app, you would send an email)
                const adminNotification = {
                    type: "withdrawal_approved",
                    withdrawalId: withdrawalId,
                    userId: userId,
                    points: points,
                    vodafoneNumber: vodafoneNumber,
                    amountDollars: points / 30000,
                    createdAt: new Date().toISOString(),
                    message: `طلب سحب جديد تمت الموافقة عليه. رقم فودافون: ${vodafoneNumber}, المبلغ: $${(points/30000).toFixed(2)} دولار`
                };
                
                await db.collection("admin_notifications").add(adminNotification);
                
                // Reload withdrawals
                loadWithdrawals();
                
            } catch (error) {
                console.error("Error approving withdrawal:", error);
                showNotification("حدث خطأ أثناء الموافقة على طلب السحب", "error");
            }
        }
        
        // Reject Withdrawal
        async function rejectWithdrawal(withdrawalId) {
            const reason = prompt("يرجى إدخال سبب الرفض:");
            if (!reason) return;
            
            try {
                // Get withdrawal to return points to user
                const withdrawalDoc = await db.collection("withdrawals").doc(withdrawalId).get();
                const withdrawal = withdrawalDoc.data();
                
                // Return points to user
                await db.collection("users").doc(withdrawal.userId).update({
                    points: firebase.firestore.FieldValue.increment(withdrawal.points)
                });
                
                // Update withdrawal status
                await db.collection("withdrawals").doc(withdrawalId).update({
                    status: "rejected",
                    rejectedAt: new Date().toISOString(),
                    adminNote: "تم رفض الطلب: " + reason
                });
                
                showNotification("تم رفض طلب السحب وإعادة النقاط للمستخدم", "success");
                loadWithdrawals();
                
            } catch (error) {
                console.error("Error rejecting withdrawal:", error);
                showNotification("حدث خطأ أثناء رفض طلب السحب", "error");
            }
        }
        
        // Load Admin Data
        function loadAdminData() {
            loadAds();
            loadWithdrawals();
            loadUsers();
        }
        
        // Show Notification
        function showNotification(message, type) {
            const notificationArea = document.getElementById("notificationArea");
            const notification = document.createElement("div");
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            notificationArea.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Logout
        function logout() {
            if (confirm("هل أنت متأكد من تسجيل الخروج؟")) {
                auth.signOut().then(() => {
                    // Hide main content, show login
                    document.getElementById("mainContent").style.display = "none";
                    document.getElementById("header").style.display = "none";
                    document.getElementById("loginSection").style.display = "flex";
                    
                    // Reset user data
                    currentUser = null;
                    userData = null;
                    
                    // Reinitialize Google Sign-In
                    initializeGoogleSignIn();
                    
                    showNotification("تم تسجيل الخروج بنجاح", "success");
                });
            }
        }
        
        // Prevent zoom on mobile
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        document.addEventListener('touchmove', function(e) {
            if(e.scale !== 1) e.preventDefault();
        }, { passive: false });
        
        // Prevent text selection except for specific elements
        document.addEventListener('selectstart', function(e) {
            if (!e.target.classList.contains('selectable-text')) {
                e.preventDefault();
            }
        });
        
        // Initialize when page loads
        window.onload = function() {
            initializeGoogleSignIn();
            
            // Check if user is already logged in
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    initializeApp();
                }
            });
        };
    </script>
</body>
</html>
