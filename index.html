<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AdVista Pro - ÿßÿ±ÿ®ÿ≠ ŸÖŸÜ ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™</title>
    
    <!-- Firebase 9 -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, query, where, orderBy, limit, increment, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getAuth, onAuthStateChanged, signInWithCredential, GoogleAuthProvider, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4fZQ-BTUeHsN9nQtMGmnjJz-NKdcUgkc",
            authDomain: "advista-b64ab.firebaseapp.com",
            projectId: "advista-b64ab",
            storageBucket: "advista-b64ab.firebasestorage.app",
            messagingSenderId: "509713648189",
            appId: "1:509713648189:web:0ccd6ada1f4e07f85d3854",
            measurementId: "G-VG4S1SMKH8"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);
        
        // Make them globally available
        window.firebase = {
            db, auth, storage, collection, doc, setDoc, getDoc, getDocs, updateDoc, deleteDoc, 
            query, where, orderBy, limit, increment, serverTimestamp, onSnapshot,
            onAuthStateChanged, signInWithCredential, GoogleAuthProvider, signOut,
            ref, uploadBytes, getDownloadURL
        };
        
        // Hide loading screen once Firebase is ready
        setTimeout(() => {
            document.getElementById('loadingScreen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 300);
        }, 1000);
    </script>
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <style>
        /* Reset CSS */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #E60000;
            --primary-dark: #CC0000;
            --primary-light: rgba(230, 0, 0, 0.1);
            --secondary: #10b981;
            --secondary-light: rgba(16, 185, 129, 0.1);
            --accent: #3b82f6;
            --accent-light: rgba(59, 130, 246, 0.1);
            --warning: #f59e0b;
            --warning-light: rgba(245, 158, 11, 0.1);
            --danger: #ef4444;
            --danger-light: rgba(239, 68, 68, 0.1);
            --dark: #1f2937;
            --light: #f9fafb;
            --gray: #6b7280;
            --gray-light: #f3f4f6;
            --gold: #fbbf24;
            --success: #10b981;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
            --radius: 16px;
            --radius-sm: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            font-size: 15px;
            line-height: 1.5;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-content {
            text-align: center;
            color: white;
            padding: 20px;
        }

        .loading-logo {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .loading-text {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* Login Page */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            animation: fadeIn 0.5s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            padding: 40px 30px;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(20px);
            animation: slideUp 0.5s ease 0.3s forwards;
        }

        @keyframes slideUp {
            to { transform: translateY(0); }
        }

        .logo {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .login-title {
            color: var(--dark);
            font-size: 2rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .login-subtitle {
            color: var(--gray);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .feature {
            background: white;
            padding: 20px;
            border-radius: var(--radius-sm);
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .feature:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .feature-icon {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .feature h4 {
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .feature p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .terms {
            color: var(--gray);
            font-size: 0.85rem;
            margin-top: 25px;
        }

        .terms a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
        }

        /* Main App */
        .main-app {
            display: none;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-logo i {
            font-size: 1.8rem;
            color: var(--primary);
        }

        .app-logo span {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--dark);
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .points-display {
            background: linear-gradient(135deg, var(--gold), #f59e0b);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            font-size: 0.95rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 3px solid var(--primary);
            object-fit: cover;
            background: var(--gray-light);
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--dark);
        }

        .user-email {
            font-size: 0.8rem;
            color: var(--gray);
        }

        /* Navigation */
        .nav-container {
            padding: 20px 0 10px;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: var(--radius);
            padding: 8px;
            box-shadow: var(--shadow);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .nav-tab {
            flex: 1;
            min-width: 90px;
            padding: 15px 10px;
            border: none;
            background: transparent;
            color: var(--gray);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border-radius: calc(var(--radius) - 4px);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .nav-tab i {
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .nav-tab.active {
            background: var(--primary-light);
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(230, 0, 0, 0.15);
        }

        .nav-tab.active i {
            transform: scale(1.1);
        }

        /* Pages */
        .page {
            display: none;
            animation: fadeInPage 0.4s ease;
        }

        @keyframes fadeInPage {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page.active {
            display: block;
        }

        .page-header {
            margin: 25px 0 20px;
        }

        .page-title {
            font-size: 1.6rem;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-subtitle {
            color: rgba(255, 255, 255, 0.8);
            margin-top: 5px;
            font-size: 0.95rem;
        }

        /* Dashboard Page */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .action-icon {
            width: 60px;
            height: 60px;
            background: var(--primary-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .action-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .action-desc {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Ads Page */
        .ads-container {
            margin-bottom: 30px;
        }

        .ads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            .ads-grid {
                grid-template-columns: 1fr;
            }
        }

        .ad-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ad-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .ad-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .ad-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .ad-content {
            padding: 25px;
        }

        .ad-category {
            display: inline-block;
            background: var(--accent-light);
            color: var(--accent);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .ad-title {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 12px;
            font-weight: 600;
            line-height: 1.3;
        }

        .ad-description {
            color: var(--gray);
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .ad-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .ad-reward {
            background: linear-gradient(135deg, var(--secondary), #059669);
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .watch-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition);
        }

        .watch-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .watch-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }

        /* Withdrawal Page */
        .withdrawal-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .balance-section {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid var(--gray-light);
        }

        .balance-label {
            color: var(--gray);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .balance-amount {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .balance-points {
            color: var(--gray);
            font-size: 1.1rem;
        }

        .withdrawal-form {
            margin-top: 25px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            font-size: 16px;
            transition: var(--transition);
            background: white;
        }

        .form-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(230, 0, 0, 0.1);
        }

        .form-hint {
            display: block;
            margin-top: 8px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: var(--transition);
            margin-top: 10px;
        }

        .submit-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .submit-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }

        .history-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .history-title {
            font-size: 1.4rem;
            color: var(--dark);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            transition: var(--transition);
        }

        .history-item:hover {
            background: var(--gray-light);
        }

        .history-info {
            flex: 1;
        }

        .history-amount {
            font-weight: 700;
            color: var(--dark);
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .history-date {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .history-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background: var(--warning-light);
            color: var(--warning);
        }

        .status-completed {
            background: var(--secondary-light);
            color: var(--secondary);
        }

        .status-rejected {
            background: var(--danger-light);
            color: var(--danger);
        }

        /* Referral Page */
        .referral-hero {
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            color: white;
            padding: 40px 30px;
            border-radius: var(--radius);
            margin-bottom: 25px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .referral-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100"><path fill="rgba(255,255,255,0.1)" d="M0,50 Q250,0 500,50 T1000,50 V100 H0 Z"/></svg>') bottom center repeat-x;
            background-size: 1000px 100px;
        }

        .referral-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            position: relative;
        }

        .referral-desc {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 25px;
            position: relative;
        }

        .referral-code-container {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: var(--radius-sm);
            margin: 25px auto;
            max-width: 500px;
            position: relative;
        }

        .referral-code {
            font-family: monospace;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 2px;
            color: white;
            margin-bottom: 15px;
        }

        .copy-btn {
            background: white;
            color: var(--accent);
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
            transition: var(--transition);
        }

        .copy-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
            position: relative;
        }

        .share-btn {
            padding: 14px 25px;
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            min-width: 140px;
            justify-content: center;
        }

        .whatsapp-btn {
            background: #25D366;
        }

        .telegram-btn {
            background: #0088cc;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .referral-stats {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .referral-list-title {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Admin Page */
        .admin-tabs {
            display: flex;
            background: white;
            border-radius: var(--radius-sm);
            padding: 6px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .admin-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--gray);
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: var(--transition);
            border-radius: calc(var(--radius-sm) - 3px);
        }

        .admin-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(230, 0, 0, 0.3);
        }

        .admin-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .admin-btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .add-btn {
            background: var(--primary);
            color: white;
        }

        .edit-btn {
            background: var(--accent);
            color: white;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
        }

        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: var(--radius-sm);
            overflow: hidden;
            box-shadow: var(--shadow);
            font-size: 0.95rem;
        }

        .admin-table th {
            background: var(--primary);
            color: white;
            padding: 18px 15px;
            text-align: right;
            font-weight: 600;
            white-space: nowrap;
        }

        .admin-table td {
            padding: 16px 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .admin-table tr:hover {
            background: var(--gray-light);
        }

        /* Timer Modal */
        .timer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .timer-content {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 40px 30px;
            border-radius: var(--radius);
            text-align: center;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-lg);
            animation: scaleIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        @keyframes scaleIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .timer-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .close-timer {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 1;
            transition: var(--transition);
        }

        .close-timer:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .timer-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
            position: relative;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .timer-display {
            font-size: 5rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .timer-warning {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: var(--radius-sm);
            margin: 20px 0;
            font-size: 1.1rem;
            position: relative;
        }

        .reward-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: var(--radius-sm);
            margin: 25px 0;
            display: none;
            position: relative;
        }

        .reward-amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .timer-instruction {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-top: 20px;
            position: relative;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            left: 20px;
            background: white;
            padding: 20px 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            display: none;
            z-index: 1001;
            animation: slideInRight 0.3s ease;
            max-width: 400px;
            margin: 0 auto;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            border-right: 5px solid var(--success);
        }

        .notification.error {
            border-right: 5px solid var(--danger);
        }

        .notification.warning {
            border-right: 5px solid var(--warning);
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .notification.success .notification-icon {
            color: var(--success);
        }

        .notification.error .notification-icon {
            color: var(--danger);
        }

        .notification.warning .notification-icon {
            color: var(--warning);
        }

        /* Settings Modal */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1002;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .settings-content {
            background: white;
            padding: 40px;
            border-radius: var(--radius);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideUp 0.3s ease;
        }

        @keyframes modalSlideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .settings-title {
            font-size: 1.8rem;
            color: var(--dark);
            margin-bottom: 30px;
            text-align: center;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* User Menu */
        .user-menu {
            display: none;
            position: absolute;
            top: 70px;
            left: 20px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            z-index: 100;
            overflow: hidden;
        }

        .user-menu.active {
            display: block;
            animation: fadeInDown 0.3s ease;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            color: var(--dark);
            text-decoration: none;
            transition: var(--transition);
            border-bottom: 1px solid var(--gray-light);
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: var(--gray-light);
            color: var(--primary);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 12px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .quick-actions {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                min-width: 80px;
                padding: 12px 8px;
                font-size: 0.85rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .user-section {
                width: 100%;
                justify-content: center;
            }
            
            .page-title {
                font-size: 1.4rem;
            }
            
            .balance-amount {
                font-size: 2.5rem;
            }
            
            .admin-table {
                display: block;
                overflow-x: auto;
            }
            
            .share-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .share-btn {
                width: 100%;
                max-width: 250px;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 30px 20px;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .ad-card {
                margin: 0 -12px;
                border-radius: 0;
                border-left: none;
                border-right: none;
            }
            
            .withdrawal-card,
            .history-section,
            .referral-stats,
            .admin-section {
                padding: 25px 20px;
            }
            
            .timer-display {
                font-size: 4rem;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--gray-light);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .mb-1 { margin-bottom: 5px; }
        .mb-2 { margin-bottom: 10px; }
        .mb-3 { margin-bottom: 15px; }
        .mb-4 { margin-bottom: 20px; }
        .mb-5 { margin-bottom: 25px; }
        .mt-1 { margin-top: 5px; }
        .mt-2 { margin-top: 10px; }
        .mt-3 { margin-top: 15px; }
        .mt-4 { margin-top: 20px; }
        .mt-5 { margin-top: 25px; }
        .d-flex { display: flex; }
        .align-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .w-100 { width: 100%; }
        .h-100 { height: 100%; }
        .gap-1 { gap: 5px; }
        .gap-2 { gap: 10px; }
        .gap-3 { gap: 15px; }
        .gap-4 { gap: 20px; }
        .gap-5 { gap: 25px; }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content">
            <div class="loading-logo">üí∞</div>
            <div class="loading-text">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ AdVista Pro...</div>
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Login Page -->
    <div class="login-page" id="loginPage">
        <div class="login-card">
            <div class="logo">üí∞</div>
            <h1 class="login-title">AdVista Pro</h1>
            <p class="login-subtitle">ÿ¥ÿßŸáÿØ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ÿå ÿßÿ±ÿ®ÿ≠ ŸÜŸÇÿßÿ∑ÿßŸãÿå Ÿàÿ≥ÿ≠ÿ® ÿ£ŸÖŸàÿßŸÑÿßŸã ÿ≠ŸÇŸäŸÇŸäÿ© ÿ•ŸÑŸâ ŸÅŸàÿØÿßŸÅŸàŸÜ ŸÉÿßÿ¥</p>
            
            <div class="features">
                <div class="feature">
                    <div class="feature-icon">üéÅ</div>
                    <h4>100 ŸÜŸÇÿ∑ÿ© ŸÖÿ¨ÿßŸÜŸäÿ©</h4>
                    <p>ÿπŸÜÿØ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ£ŸàŸÑ</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">‚è±Ô∏è</div>
                    <h4>30 ÿ´ÿßŸÜŸäÿ© ŸÅŸÇÿ∑</h4>
                    <p>ŸÑŸÉŸÑ ÿ•ÿπŸÑÿßŸÜ ÿ™ÿ¥ÿßŸáÿØŸá</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üí∞</div>
                    <h4>50 ŸÜŸÇÿ∑ÿ© ŸÑŸÉŸÑ ÿ•ÿπŸÑÿßŸÜ</h4>
                    <p>ÿ£ÿ±ÿ®ÿßÿ≠ ŸÖÿ∂ŸÖŸàŸÜÿ©</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">üë•</div>
                    <h4>10 ŸÜŸÇÿßÿ∑ ŸÑŸÑÿ•ÿ≠ÿßŸÑÿ©</h4>
                    <p>ŸÑŸÉŸÑ ÿµÿØŸäŸÇ Ÿäÿ≥ÿ¨ŸÑ</p>
                </div>
            </div>
            
            <!-- Google Sign In Button -->
            <div id="g_id_onload"
                 data-client_id="805966277330-9j5j1nvluj69f8uieog0kk77p0jb46q4.apps.googleusercontent.com"
                 data-context="signin"
                 data-ux_mode="popup"
                 data-callback="handleGoogleSignIn"
                 data-auto_prompt="false">
            </div>

            <div class="g_id_signin"
                 data-type="standard"
                 data-shape="rectangular"
                 data-theme="outline"
                 data-text="signin_with"
                 data-size="large"
                 data-logo_alignment="left"
                 data-width="100%"
                 style="margin: 30px 0; width: 100%;">
            </div>
            
            <p class="terms">
                ÿ®ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑÿå ÿ£ŸÜÿ™ ÿ™ŸàÿßŸÅŸÇ ÿπŸÑŸâ <a href="#">ÿßŸÑÿ¥ÿ±Ÿàÿ∑ ŸàÿßŸÑÿ£ÿ≠ŸÉÿßŸÖ</a> Ÿà <a href="#">ÿ≥Ÿäÿßÿ≥ÿ© ÿßŸÑÿÆÿµŸàÿµŸäÿ©</a>
            </p>
        </div>
    </div>

    <!-- Main App -->
    <div class="main-app" id="mainApp">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="app-logo">
                        <i class="fas fa-ad"></i>
                        <span>AdVista Pro</span>
                    </div>
                    
                    <div class="user-section" id="userMenuToggle">
                        <div class="points-display">
                            <i class="fas fa-coins"></i>
                            <span id="userPoints">0</span> ŸÜŸÇÿ∑ÿ©
                        </div>
                        
                        <div class="user-profile">
                            <img id="userAvatar" class="user-avatar" alt="ÿµŸàÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ">
                            <div class="user-info">
                                <div class="user-name" id="userName">ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>
                                <div class="user-email" id="userEmail">example@email.com</div>
                            </div>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- User Menu -->
        <div class="user-menu" id="userMenu">
            <a href="#" class="menu-item" onclick="switchPage('profile')">
                <i class="fas fa-user"></i>
                <span>ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä</span>
            </a>
            <a href="#" class="menu-item" onclick="showSettings()">
                <i class="fas fa-cog"></i>
                <span>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</span>
            </a>
            <a href="#" class="menu-item" onclick="showReferralModal()">
                <i class="fas fa-share-alt"></i>
                <span>ÿØÿπŸàÿ© ÿßŸÑÿ£ÿµÿØŸÇÿßÿ°</span>
            </a>
            <a href="#" class="menu-item" onclick="handleSignOut()">
                <i class="fas fa-sign-out-alt"></i>
                <span>ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</span>
            </a>
        </div>

        <!-- Navigation -->
        <div class="container nav-container">
            <nav class="nav-tabs">
                <button class="nav-tab active" data-page="dashboard" onclick="switchPage('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</span>
                </button>
                <button class="nav-tab" data-page="ads" onclick="switchPage('ads')">
                    <i class="fas fa-ad"></i>
                    <span>ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™</span>
                </button>
                <button class="nav-tab" data-page="withdrawal" onclick="switchPage('withdrawal')">
                    <i class="fas fa-wallet"></i>
                    <span>ÿßŸÑÿ≥ÿ≠ÿ®</span>
                </button>
                <button class="nav-tab" data-page="referral" onclick="switchPage('referral')">
                    <i class="fas fa-users"></i>
                    <span>ÿßŸÑÿØÿπŸàÿ©</span>
                </button>
                <button class="nav-tab" data-page="admin" id="adminTab" onclick="switchPage('admin')" style="display: none;">
                    <i class="fas fa-crown"></i>
                    <span>ÿßŸÑÿ•ÿØÿßÿ±ÿ©</span>
                </button>
            </nav>
        </div>

        <!-- Main Content -->
        <main class="container">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboardPage">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-chart-line"></i>
                        ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
                    </h1>
                    <p class="page-subtitle">ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÜÿ∏ÿßŸÖ AdVista Proÿå ÿßÿ®ÿØÿ£ ÿ±ÿ≠ŸÑÿ™ŸÉ ŸÜÿ≠Ÿà ÿßŸÑÿ±ÿ®ÿ≠</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-value" id="totalEarnings">$0</div>
                        <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-value" id="adsWatched">0</div>
                        <div class="stat-label">ÿ•ÿπŸÑÿßŸÜÿßÿ™ ÿ¥ÿßŸáÿØÿ™Ÿáÿß</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="timeWatched">0</div>
                        <div class="stat-label">ÿØŸÇÿßÿ¶ŸÇ ŸÖÿ¥ÿßŸáÿØÿ©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-value" id="referralsCount">0</div>
                        <div class="stat-label">ÿπÿØÿØ ÿßŸÑÿ•ÿ≠ÿßŸÑÿßÿ™</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <div class="action-card" onclick="switchPage('ads')">
                        <div class="action-icon">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <div class="action-title">ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™</div>
                        <div class="action-desc">ÿßÿ®ÿØÿ£ ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ Ÿàÿßÿ±ÿ®ÿ≠ ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ¢ŸÜ</div>
                    </div>
                    <div class="action-card" onclick="switchPage('withdrawal')">
                        <div class="action-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="action-title">ÿ≥ÿ≠ÿ® ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠</div>
                        <div class="action-desc">ÿßÿ≥ÿ≠ÿ® ÿ£ŸÖŸàÿßŸÑŸÉ ÿ•ŸÑŸâ ŸÅŸàÿØÿßŸÅŸàŸÜ ŸÉÿßÿ¥</div>
                    </div>
                    <div class="action-card" onclick="switchPage('referral')">
                        <div class="action-icon">
                            <i class="fas fa-gift"></i>
                        </div>
                        <div class="action-title">ÿØÿπŸàÿ© ÿßŸÑÿ£ÿµÿØŸÇÿßÿ°</div>
                        <div class="action-desc">ÿßÿØÿπŸè ÿ£ÿµÿØŸÇÿßÿ°ŸÉ Ÿàÿßÿ±ÿ®ÿ≠ 10 ŸÜŸÇÿßÿ∑ ŸÑŸÉŸÑ ÿµÿØŸäŸÇ</div>
                    </div>
                    <div class="action-card" onclick="showReferralModal()">
                        <div class="action-icon">
                            <i class="fas fa-share"></i>
                        </div>
                        <div class="action-title">ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿßŸÑÿ±ÿßÿ®ÿ∑</div>
                        <div class="action-desc">ÿ¥ÿßÿ±ŸÉ ÿ±ÿßÿ®ÿ∑ ÿØÿπŸàÿ™ŸÉ ÿπŸÑŸâ Ÿàÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ŸàÿßÿµŸÑ</div>
                    </div>
                </div>

                <!-- Admin Quick Stats -->
                <div id="adminStats" style="display: none;">
                    <div class="page-header">
                        <h1 class="page-title">
                            <i class="fas fa-crown"></i>
                            ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ©
                        </h1>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-value" id="totalUsers">0</div>
                            <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-ad"></i>
                            </div>
                            <div class="stat-value" id="activeAds">0</div>
                            <div class="stat-label">ÿ•ÿπŸÑÿßŸÜÿßÿ™ ŸÜÿ¥ÿ∑ÿ©</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-value" id="pendingWithdrawals">0</div>
                            <div class="stat-label">ÿ∑ŸÑÿ®ÿßÿ™ ÿ≥ÿ≠ÿ® ŸÖÿπŸÑŸÇÿ©</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="stat-value" id="totalRevenue">$0</div>
                            <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•Ÿäÿ±ÿßÿØÿßÿ™</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ads Page -->
            <div class="page" id="adsPage">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-ad"></i>
                        ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©
                    </h1>
                    <p class="page-subtitle">ÿ¥ÿßŸáÿØ ÿßŸÑÿ•ÿπŸÑÿßŸÜ ŸÑŸÖÿØÿ© 30 ÿ´ÿßŸÜŸäÿ© Ÿàÿßÿ±ÿ®ÿ≠ ŸÜŸÇÿßÿ∑ÿßŸã ÿ≠ŸÇŸäŸÇŸäÿ©</p>
                </div>

                <div class="ads-container">
                    <div class="ads-grid" id="adsGrid">
                        <!-- Ads will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Withdrawal Page -->
            <div class="page" id="withdrawalPage">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-wallet"></i>
                        ÿ≥ÿ≠ÿ® ÿßŸÑÿ£ÿ±ÿ®ÿßÿ≠
                    </h1>
                    <p class="page-subtitle">ÿßÿ≥ÿ≠ÿ® ÿ£ÿ±ÿ®ÿßÿ≠ŸÉ ÿ•ŸÑŸâ ÿ≠ÿ≥ÿßÿ® ŸÅŸàÿØÿßŸÅŸàŸÜ ŸÉÿßÿ¥ ÿ®ŸÉŸÑ ÿ≥ŸáŸàŸÑÿ©</p>
                </div>

                <div class="withdrawal-card">
                    <div class="balance-section">
                        <div class="balance-label">ÿ±ÿµŸäÿØŸÉ ÿßŸÑÿ≠ÿßŸÑŸä</div>
                        <div class="balance-amount" id="withdrawalBalance">$0</div>
                        <div class="balance-points" id="withdrawalPoints">0 ŸÜŸÇÿ∑ÿ©</div>
                    </div>

                    <div class="withdrawal-form">
                        <div class="form-group">
                            <label class="form-label">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ∑ŸÑŸàÿ® (ÿØŸàŸÑÿßÿ±)</label>
                            <input type="number" id="withdrawAmount" class="form-input" min="1" step="0.01" value="1" placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®">
                            <span class="form-hint">ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑÿ≥ÿ≠ÿ®: $1</span>
                        </div>

                        <div class="form-group">
                            <label class="form-label">ÿ±ŸÇŸÖ ŸÅŸàÿØÿßŸÅŸàŸÜ ŸÉÿßÿ¥</label>
                            <input type="tel" id="vodafoneNumber" class="form-input" placeholder="ÿ£ÿØÿÆŸÑ ÿ±ŸÇŸÖ ŸÅŸàÿØÿßŸÅŸàŸÜ ŸÉÿßÿ¥ (ŸÖÿ´ÿßŸÑ: 01012345678)" required>
                            <span class="form-hint">ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ŸÅŸàÿØÿßŸÅŸàŸÜ ŸÉÿßÿ¥ ÿµÿ≠Ÿäÿ≠</span>
                        </div>

                        <div class="form-group">
                            <div style="background: var(--warning-light); padding: 15px; border-radius: var(--radius-sm); margin-bottom: 20px;">
                                <div style="display: flex; align-items: center; gap: 10px; color: var(--warning);">
                                    <i class="fas fa-info-circle"></i>
                                    <div>
                                        <div style="font-weight: 600;">ŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ: 20,000 ŸÜŸÇÿ∑ÿ© = 1 ÿØŸàŸÑÿßÿ±</div>
                                        <div style="font-size: 0.9rem;">ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©: <span id="requiredPoints">20,000</span> ŸÜŸÇÿ∑ÿ©</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button class="submit-btn" id="submitWithdrawalBtn">
                            <i class="fas fa-paper-plane"></i>
                            ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ®
                        </button>
                    </div>
                </div>

                <div class="history-section">
                    <h2 class="history-title">
                        <i class="fas fa-history"></i>
                        ÿ≥ÿ¨ŸÑ ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™
                    </h2>
                    <div class="history-list" id="withdrawalHistory">
                        <!-- History will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Referral Page -->
            <div class="page" id="referralPage">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-users"></i>
                        ŸÜÿ∏ÿßŸÖ ÿßŸÑÿØÿπŸàÿ©
                    </h1>
                    <p class="page-subtitle">ÿßÿØÿπŸè ÿ£ÿµÿØŸÇÿßÿ°ŸÉ Ÿàÿßÿ±ÿ®ÿ≠ ŸÜŸÇÿßÿ∑ÿßŸã ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÖÿπ ŸÉŸÑ ÿ•ÿ≠ÿßŸÑÿ©</p>
                </div>

                <div class="referral-hero">
                    <h2 class="referral-title">üéØ ÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ŸÜŸÇÿßÿ∑ ŸÖÿ¨ÿßŸÜŸäÿ©!</h2>
                    <p class="referral-desc">ÿßÿØÿπŸè ÿ£ÿµÿØŸÇÿßÿ°ŸÉ Ÿàÿßÿ≠ÿµŸÑ ÿπŸÑŸâ 10 ŸÜŸÇÿßÿ∑ ŸÑŸÉŸÑ ÿµÿØŸäŸÇ Ÿäÿ≥ÿ¨ŸÑ ÿπÿ®ÿ± ÿ±ÿßÿ®ÿ∑ŸÉ</p>
                    
                    <div class="referral-code-container">
                        <div class="referral-code" id="referralCode">ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>
                        <button class="copy-btn" onclick="copyReferralCode()">
                            <i class="fas fa-copy"></i>
                            ŸÜÿ≥ÿÆ ŸÉŸàÿØ ÿßŸÑÿØÿπŸàÿ©
                        </button>
                    </div>

                    <div class="share-buttons">
                        <button class="share-btn whatsapp-btn" onclick="shareOnWhatsApp()">
                            <i class="fab fa-whatsapp"></i>
                            ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿπŸÑŸâ Ÿàÿßÿ™ÿ≥ÿßÿ®
                        </button>
                        <button class="share-btn telegram-btn" onclick="shareOnTelegram()">
                            <i class="fab fa-telegram"></i>
                            ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿπŸÑŸâ ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ
                        </button>
                    </div>
                </div>

                <div class="referral-stats">
                    <h2 class="section-title">
                        <i class="fas fa-chart-pie"></i>
                        ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ•ÿ≠ÿßŸÑÿßÿ™
                    </h2>
                    
                    <div class="stats-cards">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <div class="stat-value" id="totalReferrals">0</div>
                            <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ•ÿ≠ÿßŸÑÿßÿ™</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="stat-value" id="referralEarnings">0</div>
                            <div class="stat-label">ŸÜŸÇÿßÿ∑ ÿßŸÑÿ•ÿ≠ÿßŸÑÿßÿ™</div>
                        </div>
                    </div>

                    <h3 class="referral-list-title">
                        <i class="fas fa-list"></i>
                        ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ•ÿ≠ÿßŸÑÿßÿ™
                    </h3>
                    <div class="history-list" id="referralList">
                        <!-- Referrals will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Admin Page -->
            <div class="page" id="adminPage">
                <div class="page-header">
                    <h1 class="page-title">
                        <i class="fas fa-crown"></i>
                        ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ•ÿØÿßÿ±ÿ©
                    </h1>
                    <p class="page-subtitle">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ ŸàÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸàÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™</p>
                </div>

                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchAdminTab('ads')">ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™</button>
                    <button class="admin-tab" onclick="switchAdminTab('users')">ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</button>
                    <button class="admin-tab" onclick="switchAdminTab('withdrawals')">ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ≥ÿ≠ÿ®</button>
                    <button class="admin-tab" onclick="switchAdminTab('settings')">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ</button>
                    <button class="admin-tab" onclick="switchAdminTab('reports')">ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±</button>
                </div>

                <!-- Ads Management -->
                <div class="admin-section admin-tab-content active" id="adminAdsTab">
                    <h2 class="section-title">
                        <i class="fas fa-ad"></i>
                        ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™
                    </h2>
                    
                    <div class="admin-actions">
                        <button class="admin-btn add-btn" onclick="showAdModal()">
                            <i class="fas fa-plus"></i>
                            ÿ•ÿ∂ÿßŸÅÿ© ÿ•ÿπŸÑÿßŸÜ ÿ¨ÿØŸäÿØ
                        </button>
                    </div>

                    <div id="adminAdsList">
                        <!-- Ads list will be loaded here -->
                    </div>
                </div>

                <!-- Users Management -->
                <div class="admin-section admin-tab-content" id="adminUsersTab">
                    <h2 class="section-title">
                        <i class="fas fa-users"></i>
                        ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
                    </h2>
                    
                    <div class="form-group">
                        <input type="text" id="searchUsers" class="form-input" placeholder="üîç ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿßŸÑÿßÿ≥ŸÖ ÿ£Ÿà ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä...">
                    </div>

                    <div id="adminUsersList">
                        <!-- Users list will be loaded here -->
                    </div>
                </div>

                <!-- Withdrawals Management -->
                <div class="admin-section admin-tab-content" id="adminWithdrawalsTab">
                    <h2 class="section-title">
                        <i class="fas fa-money-check-alt"></i>
                        ÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ≥ÿ≠ÿ® ÿßŸÑŸÖÿπŸÑŸÇÿ©
                    </h2>

                    <div class="admin-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</th>
                                    <th>ÿßŸÑŸÖÿ®ŸÑÿ∫</th>
                                    <th>ÿ±ŸÇŸÖ ŸÅŸàÿØÿßŸÅŸàŸÜ</th>
                                    <th>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ</th>
                                    <th>ÿßŸÑÿ≠ÿßŸÑÿ©</th>
                                    <th>ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</th>
                                </tr>
                            </thead>
                            <tbody id="adminWithdrawalsTable">
                                <!-- Withdrawals will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- System Settings -->
                <div class="admin-section admin-tab-content" id="adminSettingsTab">
                    <h2 class="section-title">
                        <i class="fas fa-cog"></i>
                        ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ
                    </h2>
                    
                    <div class="settings-grid">
                        <div class="form-group">
                            <label class="form-label">ÿßŸÑŸÜŸÇÿßÿ∑ ŸÖŸÇÿßÿ®ŸÑ ÿßŸÑÿØŸàŸÑÿßÿ±</label>
                            <input type="number" id="pointsPerDollar" class="form-input" value="20000" min="1000">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ÿßŸÑŸÜŸÇÿßÿ∑ ŸÑŸÉŸÑ ÿ•ÿπŸÑÿßŸÜ</label>
                            <input type="number" id="pointsPerAd" class="form-input" value="50" min="10">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ŸÜŸÇÿßÿ∑ ÿßŸÑÿ¨ÿ≤ÿßÿ°</label>
                            <input type="number" id="penaltyPoints" class="form-input" value="5" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ŸÖÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ (ÿ´ÿßŸÜŸäÿ©)</label>
                            <input type="number" id="adDuration" class="form-input" value="30" min="10" max="120">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ŸÜŸÇÿßÿ∑ ÿßŸÑÿ™ÿ±ÿ≠Ÿäÿ®</label>
                            <input type="number" id="welcomePoints" class="form-input" value="100" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ŸÜŸÇÿßÿ∑ ÿßŸÑÿ•ÿ≠ÿßŸÑÿ©</label>
                            <input type="number" id="referralPoints" class="form-input" value="10" min="0">
                        </div>
                    </div>
                    
                    <button class="submit-btn" onclick="saveSystemSettings()" style="margin-top: 20px;">
                        <i class="fas fa-save"></i>
                        ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
                    </button>
                </div>

                <!-- Reports -->
                <div class="admin-section admin-tab-content" id="adminReportsTab">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ŸàÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
                    </h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="reportTotalUsers">0</div>
                            <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="reportTodayWatches">0</div>
                            <div class="stat-label">ŸÖÿ¥ÿßŸáÿØÿßÿ™ ÿßŸÑŸäŸàŸÖ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="reportTotalWithdrawals">0</div>
                            <div class="stat-label">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="reportSystemRevenue">$0</div>
                            <div class="stat-label">ÿ•Ÿäÿ±ÿßÿØÿßÿ™ ÿßŸÑŸÜÿ∏ÿßŸÖ</div>
                        </div>
                    </div>

                    <div class="admin-actions" style="margin-top: 30px;">
                        <button class="admin-btn" onclick="exportReport('users')">
                            <i class="fas fa-file-export"></i>
                            ÿ™ÿµÿØŸäÿ± ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
                        </button>
                        <button class="admin-btn" onclick="exportReport('withdrawals')">
                            <i class="fas fa-file-export"></i>
                            ÿ™ÿµÿØŸäÿ± ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ≥ÿ≠Ÿàÿ®ÿßÿ™
                        </button>
                        <button class="admin-btn" onclick="exportReport('ads')">
                            <i class="fas fa-file-export"></i>
                            ÿ™ÿµÿØŸäÿ± ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Timer Modal -->
        <div class="timer-modal" id="timerModal">
            <div class="timer-content">
                <button class="close-timer" onclick="cancelAdWatch()">
                    <i class="fas fa-times"></i>
                </button>
                
                <div class="timer-icon">‚è≥</div>
                <h2 style="font-size: 1.8rem; margin-bottom: 10px;">ÿ¨ÿßÿ±Ÿä ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ</h2>
                <p style="opacity: 0.9; margin-bottom: 20px;">ÿßŸÑÿ±ÿ¨ÿßÿ° ÿπÿØŸÖ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿµŸÅÿ≠ÿ© ÿ£Ÿà ÿßŸÑÿ™ÿ®ŸàŸäÿ®</p>
                
                <div class="timer-display" id="timerDisplay">30</div>
                
                <div class="timer-warning" id="timerWarning">
                    ‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±: ÿ•ÿ∞ÿß ÿÆÿ±ÿ¨ÿ™ ŸÇÿ®ŸÑ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™ÿå ÿ≥Ÿäÿ™ŸÖ ÿÆÿµŸÖ 5 ŸÜŸÇÿßÿ∑ ŸÖŸÜ ÿ±ÿµŸäÿØŸÉ!
                </div>
                
                <div class="reward-display" id="rewardDisplay">
                    <div class="reward-amount" id="rewardAmount">+0 ŸÜŸÇÿ∑ÿ©</div>
                    <p>ŸÖÿ®ÿ±ŸàŸÉ! ŸÑŸÇÿØ ÿ≠ÿµŸÑÿ™ ÿπŸÑŸâ ŸÜŸÇÿßÿ∑ ÿ¨ÿØŸäÿØÿ©</p>
                </div>
                
                <p class="timer-instruction">ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™ÿå ÿ≥ÿ™ŸÅÿ™ÿ≠ ŸÜÿßŸÅÿ∞ÿ© ÿ¨ÿØŸäÿØÿ© ŸÑŸÑÿ•ÿπŸÑÿßŸÜ</p>
            </div>
        </div>

        <!-- Notification -->
        <div class="notification" id="notification">
            <div class="notification-content">
                <div class="notification-icon">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div id="notificationMessage">ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±</div>
            </div>
        </div>
    </div>

    <!-- JavaScript Application -->
    <script>
        // Global variables
        let currentUser = null;
        let userData = null;
        let isAdmin = false;
        let currentAd = null;
        let timerInterval = null;
        let adWindow = null;
        let adStartTime = null;
        let adCompleted = false;
        let secondsLeft = 30;
        let penaltyApplied = false;
        let watchingAd = false;

        // System settings
        let systemSettings = {
            pointsPerDollar: 20000,
            pointsPerAd: 50,
            penaltyPoints: 5,
            adDuration: 30,
            welcomePoints: 100,
            referralPoints: 10
        };

        // Admin email
        const ADMIN_EMAIL = 'bo2584668@gmail.com';

        // Initialize app when Firebase is ready
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize event listeners
                initEventListeners();
                
                // Check authentication state
                firebase.onAuthStateChanged(firebase.auth, async (user) => {
                    if (user) {
                        await handleUserLogin(user);
                    } else {
                        showLoginPage();
                    }
                });
                
                // Load system settings
                await loadSystemSettings();
                
            } catch (error) {
                console.error('App initialization error:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ', 'error');
            }
        });

        // Initialize event listeners
        function initEventListeners() {
            // User menu toggle
            document.getElementById('userMenuToggle').addEventListener('click', toggleUserMenu);
            
            // Close user menu when clicking outside
            document.addEventListener('click', (e) => {
                const userMenu = document.getElementById('userMenu');
                const userMenuToggle = document.getElementById('userMenuToggle');
                
                if (!userMenuToggle.contains(e.target) && !userMenu.contains(e.target)) {
                    userMenu.classList.remove('active');
                }
            });
            
            // Withdrawal amount input
            const withdrawAmountInput = document.getElementById('withdrawAmount');
            if (withdrawAmountInput) {
                withdrawAmountInput.addEventListener('input', updateRequiredPoints);
            }
            
            // Search users input
            const searchUsersInput = document.getElementById('searchUsers');
            if (searchUsersInput) {
                searchUsersInput.addEventListener('input', searchUsers);
            }
            
            // Submit withdrawal button
            const submitWithdrawalBtn = document.getElementById('submitWithdrawalBtn');
            if (submitWithdrawalBtn) {
                submitWithdrawalBtn.addEventListener('click', submitWithdrawal);
            }
        }

        // Handle Google Sign In
        async function handleGoogleSignIn(response) {
            try {
                showLoading();
                
                const credential = firebase.GoogleAuthProvider.credential(response.credential);
                const userCredential = await firebase.signInWithCredential(firebase.auth, credential);
                
                await handleUserLogin(userCredential.user);
                
            } catch (error) {
                console.error('Google sign in error:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ', 'error');
                hideLoading();
            }
        }

        // Handle user login
        async function handleUserLogin(user) {
            try {
                currentUser = user;
                
                // Check if user exists in database
                const userRef = firebase.doc(firebase.db, 'users', user.uid);
                const userSnap = await firebase.getDoc(userRef);
                
                if (!userSnap.exists()) {
                    // New user - create user data
                    const referralCode = generateReferralCode(user.email);
                    
                    userData = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || user.email.split('@')[0],
                        photoURL: user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}&background=random`,
                        points: systemSettings.welcomePoints,
                        totalEarned: 0,
                        adsWatched: 0,
                        timeWatched: 0,
                        referrals: [],
                        totalReferrals: 0,
                        referralPoints: 0,
                        referralCode: referralCode,
                        referredBy: localStorage.getItem('referralCode') || null,
                        withdrawals: [],
                        isAdmin: user.email === ADMIN_EMAIL,
                        createdAt: firebase.serverTimestamp(),
                        lastLogin: firebase.serverTimestamp(),
                        watchedToday: [],
                        penalties: 0
                    };
                    
                    await firebase.setDoc(userRef, userData);
                    
                    // Award referral points if applicable
                    const referralCode = localStorage.getItem('referralCode');
                    if (referralCode) {
                        await awardReferralPoints(referralCode, user.email);
                        localStorage.removeItem('referralCode');
                    }
                    
                } else {
                    // Existing user
                    userData = userSnap.data();
                    
                    // Update last login
                    await firebase.updateDoc(userRef, {
                        lastLogin: firebase.serverTimestamp()
                    });
                }
                
                // Check admin status
                isAdmin = userData.isAdmin || user.email === ADMIN_EMAIL;
                if (isAdmin) {
                    document.getElementById('adminTab').style.display = 'flex';
                    document.getElementById('adminStats').style.display = 'block';
                }
                
                // Show main app
                showMainApp();
                
                // Update UI
                updateUserUI();
                await loadDashboardData();
                await loadAds();
                await loadWithdrawalHistory();
                await loadReferralData();
                
                if (isAdmin) {
                    await loadAdminData();
                }
                
                showNotification(`ŸÖÿ±ÿ≠ÿ®ÿßŸã ${userData.displayName}! üëã`, 'success');
                
            } catch (error) {
                console.error('Login handling error:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ', 'error');
            } finally {
                hideLoading();
            }
        }

        // Update user UI
        function updateUserUI() {
            if (!userData) return;
            
            // User info
            document.getElementById('userName').textContent = userData.displayName;
            document.getElementById('userEmail').textContent = userData.email;
            document.getElementById('userAvatar').src = userData.photoURL;
            document.getElementById('userPoints').textContent = userData.points.toLocaleString();
        }

        // Show login page
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }

        // Show main app
        function showMainApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
        }

        // Switch page
        function switchPage(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.page === page) {
                    tab.classList.add('active');
                }
            });
            
            // Show selected page
            document.getElementById(`${page}Page`).classList.add('active');
            
            // Load page data
            switch(page) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'ads':
                    loadAds();
                    break;
                case 'withdrawal':
                    updateWithdrawalUI();
                    break;
                case 'referral':
                    updateReferralUI();
                    break;
                case 'admin':
                    if (isAdmin) loadAdminData();
                    break;
            }
            
            // Close user menu
            document.getElementById('userMenu').classList.remove('active');
        }

        // Switch admin tab
        function switchAdminTab(tab) {
            // Hide all tab contents
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Update active tab
            document.querySelectorAll('.admin-tab').forEach(tabElement => {
                tabElement.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`admin${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`).classList.add('active');
            event.target.classList.add('active');
            
            // Load tab data
            switch(tab) {
                case 'ads':
                    loadAdminAds();
                    break;
                case 'users':
                    loadAdminUsers();
                    break;
                case 'withdrawals':
                    loadAdminWithdrawals();
                    break;
                case 'settings':
                    loadAdminSettings();
                    break;
                case 'reports':
                    loadAdminReports();
                    break;
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Update user stats
                document.getElementById('totalEarnings').textContent = `$${(userData.totalEarned || 0).toFixed(2)}`;
                document.getElementById('adsWatched').textContent = userData.adsWatched || 0;
                document.getElementById('timeWatched').textContent = Math.floor((userData.timeWatched || 0) / 60);
                document.getElementById('referralsCount').textContent = userData.totalReferrals || 0;
                
                if (isAdmin) {
                    // Load admin stats
                    const usersQuery = firebase.query(firebase.collection(firebase.db, 'users'));
                    const usersSnapshot = await firebase.getDocs(usersQuery);
                    
                    const adsQuery = firebase.query(
                        firebase.collection(firebase.db, 'ads'),
                        firebase.where('active', '==', true)
                    );
                    const adsSnapshot = await firebase.getDocs(adsQuery);
                    
                    const withdrawalsQuery = firebase.query(
                        firebase.collection(firebase.db, 'withdrawals'),
                        firebase.where('status', '==', 'pending')
                    );
                    const withdrawalsSnapshot = await firebase.getDocs(withdrawalsQuery);
                    
                    let totalRevenue = 0;
                    usersSnapshot.forEach(doc => {
                        const user = doc.data();
                        totalRevenue += user.totalEarned || 0;
                    });
                    
                    document.getElementById('totalUsers').textContent = usersSnapshot.size;
                    document.getElementById('activeAds').textContent = adsSnapshot.size;
                    document.getElementById('pendingWithdrawals').textContent = withdrawalsSnapshot.size;
                    document.getElementById('totalRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
                }
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Load ads
        async function loadAds() {
            try {
                const adsGrid = document.getElementById('adsGrid');
                adsGrid.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--gray);">
                        <div class="spinner"></div>
                        <p style="margin-top: 15px;">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™...</p>
                    </div>
                `;
                
                // Get today's date
                const today = new Date().toDateString();
                
                // Query active ads
                const adsQuery = firebase.query(
                    firebase.collection(firebase.db, 'ads'),
                    firebase.where('active', '==', true),
                    firebase.orderBy('createdAt', 'desc')
                );
                
                const adsSnapshot = await firebase.getDocs(adsQuery);
                
                adsGrid.innerHTML = '';
                
                if (adsSnapshot.empty) {
                    adsGrid.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-ad" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿπŸÑÿßŸÜÿßÿ™ ŸÖÿ™ÿßÿ≠ÿ© ÿ≠ÿßŸÑŸäÿßŸã</p>
                        </div>
                    `;
                    return;
                }
                
                adsSnapshot.forEach(doc => {
                    const ad = doc.data();
                    const adId = doc.id;
                    
                    // Check if ad was watched today
                    const isWatchedToday = userData.watchedToday?.some(watchedAd => 
                        watchedAd.adId === adId && 
                        new Date(watchedAd.date).toDateString() === today
                    ) || false;
                    
                    const adCard = document.createElement('div');
                    adCard.className = 'ad-card';
                    adCard.innerHTML = `
                        ${ad.image ? `
                            <div style="position: relative;">
                                <img src="${ad.image}" class="ad-image" alt="${ad.title}">
                                ${ad.featured ? '<div class="ad-badge">üî• ŸÖŸÖŸäÿ≤</div>' : ''}
                            </div>
                        ` : ''}
                        
                        <div class="ad-content">
                            <div class="ad-category">${ad.category || 'ÿπÿßŸÖ'}</div>
                            <h3 class="ad-title">${ad.title}</h3>
                            <p class="ad-description">${ad.description}</p>
                            
                            <div class="ad-stats">
                                <div class="stat">
                                    <i class="fas fa-clock"></i>
                                    <span>${systemSettings.adDuration} ÿ´ÿßŸÜŸäÿ©</span>
                                </div>
                                <div class="stat">
                                    <i class="fas fa-eye"></i>
                                    <span>${ad.views || 0} ŸÖÿ¥ÿßŸáÿØÿ©</span>
                                </div>
                                <div class="stat">
                                    <i class="fas fa-user-check"></i>
                                    <span>${ad.completed || 0} ÿ•ŸÉŸÖÿßŸÑ</span>
                                </div>
                            </div>
                            
                            <div class="ad-reward">+${ad.points || systemSettings.pointsPerAd} ŸÜŸÇÿ∑ÿ©</div>
                            
                            ${isWatchedToday ? 
                                `<button class="watch-btn" disabled>
                                    <i class="fas fa-check-circle"></i>
                                    ÿ¥ŸàŸáÿØ ÿßŸÑŸäŸàŸÖ
                                </button>` :
                                `<button class="watch-btn" onclick="watchAd('${adId}')">
                                    <i class="fas fa-play"></i>
                                    ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ
                                </button>`
                            }
                        </div>
                    `;
                    
                    adsGrid.appendChild(adCard);
                });
                
            } catch (error) {
                console.error('Error loading ads:', error);
                document.getElementById('adsGrid').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--danger);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <p>ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™</p>
                        <button onclick="loadAds()" style="margin-top: 15px; padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: var(--radius-sm); cursor: pointer;">
                            <i class="fas fa-redo"></i> ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©
                        </button>
                    </div>
                `;
            }
        }

        // Watch ad
        async function watchAd(adId) {
            if (watchingAd) {
                showNotification('ÿ¨ÿßÿ±Ÿä ŸÖÿ¥ÿßŸáÿØÿ© ÿ•ÿπŸÑÿßŸÜ ÿ≠ÿßŸÑŸäÿßŸã', 'warning');
                return;
            }
            
            try {
                // Get ad data
                const adRef = firebase.doc(firebase.db, 'ads', adId);
                const adSnap = await firebase.getDoc(adRef);
                
                if (!adSnap.exists()) {
                    showNotification('ÿßŸÑÿ•ÿπŸÑÿßŸÜ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ', 'error');
                    return;
                }
                
                const ad = adSnap.data();
                currentAd = { id: adId, ...ad };
                
                // Check if already watched today
                const today = new Date().toDateString();
                const isWatchedToday = userData.watchedToday?.some(watchedAd => 
                    watchedAd.adId === adId && 
                    new Date(watchedAd.date).toDateString() === today
                ) || false;
                
                if (isWatchedToday) {
                    showNotification('ŸÑŸÇÿØ ÿ¥ÿßŸáÿØÿ™ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿπŸÑÿßŸÜ ÿßŸÑŸäŸàŸÖ ÿ®ÿßŸÑŸÅÿπŸÑ', 'warning');
                    return;
                }
                
                // Start watching
                watchingAd = true;
                secondsLeft = systemSettings.adDuration;
                adCompleted = false;
                penaltyApplied = false;
                adStartTime = Date.now();
                
                // Show timer modal
                document.getElementById('timerModal').style.display = 'flex';
                document.getElementById('timerDisplay').textContent = secondsLeft;
                document.getElementById('timerWarning').style.display = 'block';
                document.getElementById('rewardDisplay').style.display = 'none';
                
                // Start countdown
                timerInterval = setInterval(() => {
                    secondsLeft--;
                    document.getElementById('timerDisplay').textContent = secondsLeft;
                    
                    if (secondsLeft <= 0) {
                        completeAdWatch(true);
                    }
                }, 1000);
                
                // Open ad in new window after 2 seconds
                setTimeout(() => {
                    if (!adCompleted) {
                        adWindow = window.open(ad.link || 'https://example.com', '_blank', 'width=800,height=600');
                        monitorAdWatch();
                    }
                }, 2000);
                
            } catch (error) {
                console.error('Error watching ad:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜ', 'error');
                resetAdWatch();
            }
        }

        // Monitor ad watch
        function monitorAdWatch() {
            let lastFocusTime = Date.now();
            let hiddenTime = 0;
            let windowClosed = false;
            
            // Check every second
            const monitorInterval = setInterval(() => {
                if (document.hidden) {
                    hiddenTime += 1000;
                    
                    // Penalty if hidden for more than 3 seconds
                    if (hiddenTime > 3000 && !penaltyApplied && !adCompleted) {
                        applyPenalty('ÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ ŸÖÿ∫ÿßÿØÿ±ÿ© ÿßŸÑÿµŸÅÿ≠ÿ©!');
                    }
                } else {
                    hiddenTime = 0;
                    lastFocusTime = Date.now();
                }
                
                // Check if ad window is closed
                if (adWindow && adWindow.closed && !windowClosed && !adCompleted) {
                    windowClosed = true;
                    if (!penaltyApplied) {
                        applyPenalty('ÿ™ŸÖ ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ!');
                    }
                }
                
                // Penalty if tab not focused for too long
                if (Date.now() - lastFocusTime > 5000 && !penaltyApplied && !adCompleted) {
                    applyPenalty('ÿ™ŸÖ ÿ™ÿ±ŸÉ ÿßŸÑÿµŸÅÿ≠ÿ© ŸÑŸÅÿ™ÿ±ÿ© ÿ∑ŸàŸäŸÑÿ©!');
                }
                
            }, 1000);
            
            // Cleanup when ad is completed or after duration
            setTimeout(() => {
                clearInterval(monitorInterval);
            }, (systemSettings.adDuration + 10) * 1000);
        }

        // Apply penalty
        async function applyPenalty(reason) {
            if (penaltyApplied || adCompleted) return;
            
            penaltyApplied = true;
            clearInterval(timerInterval);
            
            try {
                // Deduct penalty points
                const penaltyPoints = systemSettings.penaltyPoints;
                userData.points = Math.max(0, (userData.points || 0) - penaltyPoints);
                
                // Update in database
                const userRef = firebase.doc(firebase.db, 'users', currentUser.uid);
                await firebase.updateDoc(userRef, {
                    points: userData.points,
                    penalties: firebase.increment(1)
                });
                
                // Record penalty
                await firebase.addDoc(firebase.collection(firebase.db, 'penalties'), {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    adId: currentAd.id,
                    reason: reason,
                    points: penaltyPoints,
                    timestamp: firebase.serverTimestamp()
                });
                
                // Update UI
                updateUserUI();
                
                // Show penalty message
                document.getElementById('timerWarning').innerHTML = `
                    ‚ö†Ô∏è ${reason}<br>
                    <strong>ÿ™ŸÖ ÿÆÿµŸÖ ${penaltyPoints} ŸÜŸÇÿßÿ∑ ŸÖŸÜ ÿ±ÿµŸäÿØŸÉ!</strong>
                `;
                document.getElementById('timerWarning').style.background = 'rgba(239, 68, 68, 0.3)';
                
                showNotification(`‚ö†Ô∏è ${reason} - ÿ™ŸÖ ÿÆÿµŸÖ ${penaltyPoints} ŸÜŸÇÿßÿ∑`, 'warning');
                
                // Reset after 3 seconds
                setTimeout(resetAdWatch, 3000);
                
            } catch (error) {
                console.error('Error applying penalty:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿπŸÇŸàÿ®ÿ©', 'error');
                resetAdWatch();
            }
        }

        // Complete ad watch
        async function completeAdWatch(success = true) {
            if (adCompleted) return;
            
            adCompleted = true;
            clearInterval(timerInterval);
            
            // Close ad window if open
            if (adWindow && !adWindow.closed) {
                try {
                    adWindow.close();
                } catch (e) {
                    console.log('Could not close ad window');
                }
            }
            
            if (success) {
                try {
                    // Calculate actual watch time
                    const watchTime = Math.floor((Date.now() - adStartTime) / 1000);
                    
                    // Check if watched enough (at least 80%)
                    if (watchTime >= systemSettings.adDuration * 0.8) {
                        // Award points
                        const points = currentAd.points || systemSettings.pointsPerAd;
                        userData.points = (userData.points || 0) + points;
                        userData.totalEarned = (userData.totalEarned || 0) + (points / systemSettings.pointsPerDollar);
                        userData.adsWatched = (userData.adsWatched || 0) + 1;
                        userData.timeWatched = (userData.timeWatched || 0) + systemSettings.adDuration;
                        
                        // Add to watched today
                        const today = new Date().toDateString();
                        userData.watchedToday = userData.watchedToday || [];
                        userData.watchedToday.push({
                            adId: currentAd.id,
                            adTitle: currentAd.title,
                            points: points,
                            date: new Date().toISOString()
                        });
                        
                        // Update user in database
                        const userRef = firebase.doc(firebase.db, 'users', currentUser.uid);
                        await firebase.updateDoc(userRef, {
                            points: userData.points,
                            totalEarned: userData.totalEarned,
                            adsWatched: userData.adsWatched,
                            timeWatched: userData.timeWatched,
                            watchedToday: userData.watchedToday
                        });
                        
                        // Update ad stats
                        const adRef = firebase.doc(firebase.db, 'ads', currentAd.id);
                        await firebase.updateDoc(adRef, {
                            views: firebase.increment(1),
                            completed: firebase.increment(1)
                        });
                        
                        // Record ad watch
                        await firebase.addDoc(firebase.collection(firebase.db, 'ad_watches'), {
                            userId: currentUser.uid,
                            userEmail: currentUser.email,
                            adId: currentAd.id,
                            adTitle: currentAd.title,
                            points: points,
                            watchTime: watchTime,
                            timestamp: firebase.serverTimestamp()
                        });
                        
                        // Show success message
                        document.getElementById('timerWarning').style.display = 'none';
                        document.getElementById('rewardDisplay').style.display = 'block';
                        document.getElementById('rewardAmount').textContent = `+${points} ŸÜŸÇÿ∑ÿ©`;
                        
                        // Update UI
                        updateUserUI();
                        loadDashboardData();
                        
                        showNotification(`üéâ ŸÖÿ®ÿ±ŸàŸÉ! ŸÑŸÇÿØ ÿ±ÿ®ÿ≠ÿ™ ${points} ŸÜŸÇÿ∑ÿ©`, 'success');
                        
                        // Reset after 3 seconds
                        setTimeout(() => {
                            resetAdWatch();
                            loadAds(); // Refresh ads
                        }, 3000);
                        
                    } else {
                        // Didn't watch enough
                        applyPenalty('ŸÑŸÖ ÿ™ŸÉŸÖŸÑ ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ ŸÑŸÑŸÖÿØÿ© ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©!');
                    }
                    
                } catch (error) {
                    console.error('Error completing ad watch:', error);
                    showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÉŸÖÿßŸÑ ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ', 'error');
                    resetAdWatch();
                }
            }
        }

        // Reset ad watch
        function resetAdWatch() {
            clearInterval(timerInterval);
            
            document.getElementById('timerModal').style.display = 'none';
            document.getElementById('timerWarning').style.display = 'block';
            document.getElementById('timerWarning').innerHTML = '‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±: ÿ•ÿ∞ÿß ÿÆÿ±ÿ¨ÿ™ ŸÇÿ®ŸÑ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™ÿå ÿ≥Ÿäÿ™ŸÖ ÿÆÿµŸÖ 5 ŸÜŸÇÿßÿ∑!';
            document.getElementById('timerWarning').style.background = 'rgba(255, 255, 255, 0.2)';
            document.getElementById('rewardDisplay').style.display = 'none';
            
            currentAd = null;
            adWindow = null;
            adStartTime = null;
            secondsLeft = systemSettings.adDuration;
            watchingAd = false;
            adCompleted = false;
            penaltyApplied = false;
        }

        // Cancel ad watch
        function cancelAdWatch() {
            if (!adCompleted && !penaltyApplied) {
                if (confirm('ÿ•ÿ∞ÿß ÿ£ÿ∫ŸÑŸÇÿ™ ÿßŸÑÿ¢ŸÜÿå ÿ≥Ÿäÿ™ŸÖ ÿÆÿµŸÖ 5 ŸÜŸÇÿßÿ∑ ŸÖŸÜ ÿ±ÿµŸäÿØŸÉ. ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØÿü')) {
                    applyPenalty('ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜ!');
                }
            } else {
                resetAdWatch();
            }
        }

        // Update withdrawal UI
        function updateWithdrawalUI() {
            if (!userData) return;
            
            const points = userData.points || 0;
            const dollars = points / systemSettings.pointsPerDollar;
            
            document.getElementById('withdrawalBalance').textContent = `$${dollars.toFixed(2)}`;
            document.getElementById('withdrawalPoints').textContent = points.toLocaleString() + ' ŸÜŸÇÿ∑ÿ©';
            updateRequiredPoints();
        }

        // Update required points
        function updateRequiredPoints() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 1;
            const requiredPoints = Math.ceil(amount * systemSettings.pointsPerDollar);
            document.getElementById('requiredPoints').textContent = requiredPoints.toLocaleString();
        }

        // Submit withdrawal
        async function submitWithdrawal() {
            if (!currentUser) {
                showNotification('Ÿäÿ¨ÿ® ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ£ŸàŸÑÿßŸã', 'warning');
                return;
            }
            
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 1;
            const requiredPoints = Math.ceil(amount * systemSettings.pointsPerDollar);
            const vodafoneNumber = document.getElementById('vodafoneNumber').value.trim();
            
            // Validation
            if (userData.points < requiredPoints) {
                showNotification('‚ùå ŸÑÿß ÿ™ŸÖŸÑŸÉ ŸÜŸÇÿßÿ∑ÿßŸã ŸÉÿßŸÅŸäÿ© ŸÑŸÑÿ≥ÿ≠ÿ®', 'error');
                return;
            }
            
            if (amount < 1) {
                showNotification('‚ùå ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ ŸÑŸÑÿ≥ÿ≠ÿ® ŸáŸà 1 ÿØŸàŸÑÿßÿ±', 'error');
                return;
            }
            
            if (!vodafoneNumber || !/^01[0-2|5]\d{8}$/.test(vodafoneNumber)) {
                showNotification('‚ùå Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ±ŸÇŸÖ ŸÅŸàÿØÿßŸÅŸàŸÜ ŸÉÿßÿ¥ ÿµÿ≠Ÿäÿ≠', 'error');
                return;
            }
            
            try {
                const btn = document.getElementById('submitWithdrawalBtn');
                btn.disabled = true;
                btn.innerHTML = '<div class="spinner" style="width: 20px; height: 20px;"></div> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ...';
                
                // Create withdrawal request
                const withdrawalData = {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: currentUser.displayName,
                    userPhoto: currentUser.photoURL,
                    amount: amount,
                    points: requiredPoints,
                    vodafoneNumber: vodafoneNumber,
                    status: 'pending',
                    createdAt: firebase.serverTimestamp()
                };
                
                // Deduct points from user
                userData.points -= requiredPoints;
                
                // Save to database
                await Promise.all([
                    firebase.addDoc(firebase.collection(firebase.db, 'withdrawals'), withdrawalData),
                    firebase.updateDoc(firebase.doc(firebase.db, 'users', currentUser.uid), {
                        points: userData.points
                    })
                ]);
                
                // Add to user's withdrawals
                userData.withdrawals = userData.withdrawals || [];
                userData.withdrawals.push(withdrawalData);
                
                // Reset form
                document.getElementById('withdrawAmount').value = 1;
                document.getElementById('vodafoneNumber').value = '';
                
                // Update UI
                updateUserUI();
                updateWithdrawalUI();
                loadWithdrawalHistory();
                
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ®';
                
                showNotification(`‚úÖ ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ® ÿ®ŸÜÿ¨ÿßÿ≠!`, 'success');
                
            } catch (error) {
                console.error('Withdrawal submission error:', error);
                showNotification('‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ®', 'error');
                
                const btn = document.getElementById('submitWithdrawalBtn');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> ÿ•ÿ±ÿ≥ÿßŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ®';
            }
        }

        // Load withdrawal history
        async function loadWithdrawalHistory() {
            try {
                const historyContainer = document.getElementById('withdrawalHistory');
                historyContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--gray);"><div class="spinner"></div></div>';
                
                const withdrawalsQuery = firebase.query(
                    firebase.collection(firebase.db, 'withdrawals'),
                    firebase.where('userId', '==', currentUser.uid),
                    firebase.orderBy('createdAt', 'desc'),
                    firebase.limit(10)
                );
                
                const withdrawalsSnapshot = await firebase.getDocs(withdrawalsQuery);
                
                historyContainer.innerHTML = '';
                
                if (withdrawalsSnapshot.empty) {
                    historyContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--gray);">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ≥ÿ≠Ÿàÿ®ÿßÿ™ ÿ≥ÿßÿ®ŸÇÿ©</div>';
                    return;
                }
                
                withdrawalsSnapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    const date = withdrawal.createdAt?.toDate ? withdrawal.createdAt.toDate() : new Date();
                    
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div class="history-info">
                            <div class="history-amount">$${withdrawal.amount.toFixed(2)}</div>
                            <div class="history-date">${date.toLocaleDateString('ar-EG')} - ${date.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}</div>
                        </div>
                        <div>
                            <span class="history-status status-${withdrawal.status}">
                                ${withdrawal.status === 'pending' ? '‚è≥ ŸÇŸäÿØ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿ©' : 
                                  withdrawal.status === 'completed' ? '‚úÖ ŸÖŸÉÿ™ŸÖŸÑ' : 
                                  withdrawal.status === 'rejected' ? '‚ùå ŸÖÿ±ŸÅŸàÿ∂' : withdrawal.status}
                            </span>
                        </div>
                    `;
                    historyContainer.appendChild(historyItem);
                });
                
            } catch (error) {
                console.error('Error loading withdrawal history:', error);
                document.getElementById('withdrawalHistory').innerHTML = '<div style="text-align: center; padding: 30px; color: var(--danger);">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ÿ¨ŸÑ</div>';
            }
        }

        // Update referral UI
        function updateReferralUI() {
            document.getElementById('referralCode').textContent = userData.referralCode || 'ÿ¨ÿßÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...';
            document.getElementById('totalReferrals').textContent = userData.totalReferrals || 0;
            document.getElementById('referralEarnings').textContent = userData.referralPoints || 0;
            
            loadReferralList();
        }

        // Load referral list
        async function loadReferralList() {
            try {
                const listContainer = document.getElementById('referralList');
                listContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--gray);"><div class="spinner"></div></div>';
                
                const referralsQuery = firebase.query(
                    firebase.collection(firebase.db, 'users'),
                    firebase.where('referredBy', '==', currentUser.uid),
                    firebase.orderBy('createdAt', 'desc'),
                    firebase.limit(20)
                );
                
                const referralsSnapshot = await firebase.getDocs(referralsQuery);
                
                listContainer.innerHTML = '';
                
                if (referralsSnapshot.empty) {
                    listContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--gray);">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ≠ÿßŸÑÿßÿ™ ÿ≠ÿ™Ÿâ ÿßŸÑÿ¢ŸÜ</div>';
                    return;
                }
                
                referralsSnapshot.forEach(doc => {
                    const referral = doc.data();
                    const date = referral.createdAt?.toDate ? referral.createdAt.toDate() : new Date();
                    
                    const referralItem = document.createElement('div');
                    referralItem.className = 'history-item';
                    referralItem.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <img src="${referral.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(referral.displayName || referral.email) + '&background=random'}" 
                                 style="width: 40px; height: 40px; border-radius: 50%;">
                            <div>
                                <div style="font-weight: 600; color: var(--dark);">${referral.displayName || referral.email}</div>
                                <div style="font-size: 0.85rem; color: var(--gray);">${date.toLocaleDateString('ar-EG')}</div>
                            </div>
                        </div>
                        <div style="color: var(--success); font-weight: 600; font-size: 1.1rem;">
                            +${systemSettings.referralPoints} ŸÜŸÇÿ∑ÿ©
                        </div>
                    `;
                    listContainer.appendChild(referralItem);
                });
                
            } catch (error) {
                console.error('Error loading referral list:', error);
                document.getElementById('referralList').innerHTML = '<div style="text-align: center; padding: 30px; color: var(--danger);">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ≠ÿßŸÑÿßÿ™</div>';
            }
        }

        // Award referral points
        async function awardReferralPoints(referralCode, referredEmail) {
            try {
                // Find user by referral code
                const usersQuery = firebase.query(
                    firebase.collection(firebase.db, 'users'),
                    firebase.where('referralCode', '==', referralCode)
                );
                
                const usersSnapshot = await firebase.getDocs(usersQuery);
                
                if (!usersSnapshot.empty) {
                    const referrerDoc = usersSnapshot.docs[0];
                    const referrerData = referrerDoc.data();
                    
                    // Award points to referrer
                    await firebase.updateDoc(firebase.doc(firebase.db, 'users', referrerDoc.id), {
                        points: firebase.increment(systemSettings.referralPoints),
                        referralPoints: firebase.increment(systemSettings.referralPoints),
                        totalReferrals: firebase.increment(1)
                    });
                    
                    // Add to referrals list
                    const newReferral = {
                        email: referredEmail,
                        date: new Date().toISOString(),
                        points: systemSettings.referralPoints
                    };
                    
                    const referrals = referrerData.referrals || [];
                    referrals.push(newReferral);
                    
                    await firebase.updateDoc(firebase.doc(firebase.db, 'users', referrerDoc.id), {
                        referrals: referrals
                    });
                    
                    // Send notification if referrer is online
                    if (window.currentUser && window.currentUser.uid === referrerDoc.id) {
                        showNotification(`üéâ ÿ≠ÿµŸÑÿ™ ÿπŸÑŸâ ${systemSettings.referralPoints} ŸÜŸÇÿ∑ÿ© ŸÑÿ•ÿ≠ÿßŸÑÿ© ÿ¨ÿØŸäÿØÿ©!`, 'success');
                    }
                }
            } catch (error) {
                console.error('Error awarding referral points:', error);
            }
        }

        // Copy referral code
        function copyReferralCode() {
            if (!userData.referralCode) return;
            
            navigator.clipboard.writeText(userData.referralCode).then(() => {
                showNotification('‚úÖ ÿ™ŸÖ ŸÜÿ≥ÿÆ ŸÉŸàÿØ ÿßŸÑÿØÿπŸàÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            }).catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = userData.referralCode;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('‚úÖ ÿ™ŸÖ ŸÜÿ≥ÿÆ ŸÉŸàÿØ ÿßŸÑÿØÿπŸàÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            });
        }

        // Share on WhatsApp
        function shareOnWhatsApp() {
            if (!userData.referralCode) return;
            
            const link = `${window.location.origin}?ref=${userData.referralCode}`;
            const text = `ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸâ AdVista Pro Ÿàÿßÿ±ÿ®ÿ≠ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÖŸÜ ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™! üéØ\n\nÿ≥ÿ¨ŸÑ ÿπÿ®ÿ± ÿ±ÿßÿ®ÿ∑Ÿä Ÿàÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ${systemSettings.welcomePoints} ŸÜŸÇÿ∑ÿ© ŸáÿØŸäÿ©:\n${link}\n\n#AdVistaPro #ÿ±ÿ®ÿ≠_ÿßŸÑŸÜŸÇÿßÿ∑`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }

        // Share on Telegram
        function shareOnTelegram() {
            if (!userData.referralCode) return;
            
            const link = `${window.location.origin}?ref=${userData.referralCode}`;
            const text = `ÿßŸÜÿ∂ŸÖ ÿ•ŸÑŸâ AdVista Pro Ÿàÿßÿ±ÿ®ÿ≠ ÿßŸÑŸÜŸÇÿßÿ∑ ŸÖŸÜ ŸÖÿ¥ÿßŸáÿØÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™! üéØ\n\nÿ≥ÿ¨ŸÑ ÿπÿ®ÿ± ÿ±ÿßÿ®ÿ∑Ÿä Ÿàÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ${systemSettings.welcomePoints} ŸÜŸÇÿ∑ÿ© ŸáÿØŸäÿ©:\n${link}\n\n#AdVistaPro #ÿ±ÿ®ÿ≠_ÿßŸÑŸÜŸÇÿßÿ∑`;
            window.open(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(text)}`, '_blank');
        }

        // Toggle user menu
        function toggleUserMenu() {
            document.getElementById('userMenu').classList.toggle('active');
        }

        // Show referral modal
        function showReferralModal() {
            // In a real app, you would show a modal with sharing options
            // For now, just copy the referral link
            if (userData.referralCode) {
                const link = `${window.location.origin}?ref=${userData.referralCode}`;
                navigator.clipboard.writeText(link).then(() => {
                    showNotification('‚úÖ ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿØÿπŸàÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                });
            }
        }

        // Show settings
        function showSettings() {
            // In a real app, show settings modal
            showNotification('ÿ™ÿ∑ŸàŸäÿ± ŸÇÿßÿØŸÖ: ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ', 'info');
        }

        // Load admin data
        async function loadAdminData() {
            if (!isAdmin) return;
            
            try {
                await loadAdminAds();
                await loadAdminUsers();
                await loadAdminWithdrawals();
                await loadAdminSettings();
                await loadAdminReports();
                
            } catch (error) {
                console.error('Error loading admin data:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ©', 'error');
            }
        }

        // Load admin ads
        async function loadAdminAds() {
            try {
                const adsContainer = document.getElementById('adminAdsList');
                adsContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--gray);"><div class="spinner"></div></div>';
                
                const adsQuery = firebase.query(
                    firebase.collection(firebase.db, 'ads'),
                    firebase.orderBy('createdAt', 'desc')
                );
                
                const adsSnapshot = await firebase.getDocs(adsQuery);
                
                adsContainer.innerHTML = '';
                
                if (adsSnapshot.empty) {
                    adsContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--gray);">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿπŸÑÿßŸÜÿßÿ™</div>';
                    return;
                }
                
                adsSnapshot.forEach(doc => {
                    const ad = doc.data();
                    const date = ad.createdAt?.toDate ? ad.createdAt.toDate() : new Date();
                    
                    const adItem = document.createElement('div');
                    adItem.className = 'ad-card';
                    adItem.style.marginBottom = '20px';
                    adItem.innerHTML = `
                        <div class="ad-content">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                                <div>
                                    <h3 style="margin: 0 0 10px 0; color: var(--dark); font-size: 1.2rem;">${ad.title}</h3>
                                    <div style="display: flex; gap: 10px; font-size: 0.9rem; color: var(--gray);">
                                        <span>${ad.category || 'ÿπÿßŸÖ'}</span>
                                        <span>‚Ä¢</span>
                                        <span>${date.toLocaleDateString('ar-EG')}</span>
                                        <span>‚Ä¢</span>
                                        <span>${ad.active ? 'üü¢ ŸÜÿ¥ÿ∑' : 'üî¥ ÿ∫Ÿäÿ± ŸÜÿ¥ÿ∑'}</span>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="admin-btn edit-btn" onclick="editAd('${doc.id}')">
                                        <i class="fas fa-edit"></i> ÿ™ÿπÿØŸäŸÑ
                                    </button>
                                    <button class="admin-btn delete-btn" onclick="deleteAd('${doc.id}')">
                                        <i class="fas fa-trash"></i> ÿ≠ÿ∞ŸÅ
                                    </button>
                                </div>
                            </div>
                            
                            <p style="color: var(--gray); margin-bottom: 15px; line-height: 1.6;">${ad.description}</p>
                            
                            <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--gray); padding-top: 15px; border-top: 1px solid var(--gray-light);">
                                <div>
                                    <span style="display: inline-block; margin-left: 15px;">ÿßŸÑŸÜŸÇÿßÿ∑: <strong>${ad.points || 0}</strong></span>
                                    <span style="display: inline-block; margin-left: 15px;">ÿßŸÑŸÖÿ¥ÿßŸáÿØÿßÿ™: <strong>${ad.views || 0}</strong></span>
                                    <span style="display: inline-block; margin-left: 15px;">ÿßŸÑÿ•ŸÉŸÖÿßŸÑÿßÿ™: <strong>${ad.completed || 0}</strong></span>
                                </div>
                                ${ad.featured ? '<span style="background: var(--warning); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8rem;">ŸÖŸÖŸäÿ≤</span>' : ''}
                            </div>
                        </div>
                    `;
                    adsContainer.appendChild(adItem);
                });
                
            } catch (error) {
                console.error('Error loading admin ads:', error);
                document.getElementById('adminAdsList').innerHTML = '<div style="text-align: center; padding: 30px; color: var(--danger);">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™</div>';
            }
        }

        // Load admin users
        async function loadAdminUsers() {
            try {
                const usersContainer = document.getElementById('adminUsersList');
                usersContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--gray);"><div class="spinner"></div></div>';
                
                const usersQuery = firebase.query(
                    firebase.collection(firebase.db, 'users'),
                    firebase.orderBy('createdAt', 'desc'),
                    firebase.limit(50)
                );
                
                const usersSnapshot = await firebase.getDocs(usersQuery);
                
                usersContainer.innerHTML = '';
                
                if (usersSnapshot.empty) {
                    usersContainer.innerHTML = '<div style="text-align: center; padding: 30px; color: var(--gray);">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ</div>';
                    return;
                }
                
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    const date = user.createdAt?.toDate ? user.createdAt.toDate() : new Date();
                    
                    const userItem = document.createElement('div');
                    userItem.className = 'history-item';
                    userItem.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <img src="${user.photoURL || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.displayName || user.email) + '&background=random'}" 
                                 style="width: 50px; height: 50px; border-radius: 50%;">
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                    <div style="font-weight: 600; color: var(--dark); font-size: 1.1rem;">${user.displayName || user.email}</div>
                                    ${user.isAdmin ? '<span style="background: var(--primary); color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8rem;">ŸÖÿØŸäÿ±</span>' : ''}
                                </div>
                                <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 5px;">${user.email}</div>
                                <div style="display: flex; gap: 15px; font-size: 0.85rem; color: var(--gray);">
                                    <span>ÿßŸÑŸÜŸÇÿßÿ∑: <strong>${user.points || 0}</strong></span>
                                    <span>ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™: <strong>${user.adsWatched || 0}</strong></span>
                                    <span>ÿßŸÑÿ•ÿ≠ÿßŸÑÿßÿ™: <strong>${user.totalReferrals || 0}</strong></span>
                                    <span>ÿßŸÑÿ™ÿßÿ±ŸäÿÆ: ${date.toLocaleDateString('ar-EG')}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    usersContainer.appendChild(userItem);
                });
                
            } catch (error) {
                console.error('Error loading admin users:', error);
                document.getElementById('adminUsersList').innerHTML = '<div style="text-align: center; padding: 30px; color: var(--danger);">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</div>';
            }
        }

        // Search users
        async function searchUsers() {
            const searchTerm = document.getElementById('searchUsers').value.toLowerCase();
            const usersList = document.getElementById('adminUsersList');
            const items = usersList.querySelectorAll('.history-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(searchTerm) ? 'flex' : 'none';
            });
        }

        // Load admin withdrawals
        async function loadAdminWithdrawals() {
            try {
                const tableBody = document.getElementById('adminWithdrawalsTable');
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px; color: var(--gray);"><div class="spinner"></div></td></tr>';
                
                const withdrawalsQuery = firebase.query(
                    firebase.collection(firebase.db, 'withdrawals'),
                    firebase.where('status', '==', 'pending'),
                    firebase.orderBy('createdAt', 'desc')
                );
                
                const withdrawalsSnapshot = await firebase.getDocs(withdrawalsQuery);
                
                tableBody.innerHTML = '';
                
                if (withdrawalsSnapshot.empty) {
                    tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px; color: var(--gray);">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∑ŸÑÿ®ÿßÿ™ ÿ≥ÿ≠ÿ® ŸÖÿπŸÑŸÇÿ©</td></tr>';
                    return;
                }
                
                withdrawalsSnapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    const date = withdrawal.createdAt?.toDate ? withdrawal.createdAt.toDate() : new Date();
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <img src="${withdrawal.userPhoto || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(withdrawal.userName || withdrawal.userEmail) + '&background=random'}" 
                                     style="width: 40px; height: 40px; border-radius: 50%;">
                                <div>
                                    <div style="font-weight: 600; font-size: 0.95rem;">${withdrawal.userName}</div>
                                    <div style="font-size: 0.8rem; color: var(--gray);">${withdrawal.userEmail}</div>
                                </div>
                            </div>
                        </td>
                        <td style="font-weight: 700; color: var(--primary); font-size: 1.1rem;">$${withdrawal.amount.toFixed(2)}</td>
                        <td dir="ltr" style="font-family: monospace; font-size: 0.95rem;">${withdrawal.vodafoneNumber}</td>
                        <td>${date.toLocaleDateString('ar-EG')}<br><span style="font-size: 0.8rem; color: var(--gray);">${date.toLocaleTimeString('ar-EG', { hour: '2-digit', minute: '2-digit' })}</span></td>
                        <td>
                            <span class="history-status status-pending">‚è≥ ŸÇŸäÿØ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿ©</span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 8px;">
                                <button class="admin-btn edit-btn" onclick="approveWithdrawal('${doc.id}')" style="padding: 8px 15px; font-size: 0.85rem;">
                                    <i class="fas fa-check"></i> ŸÇÿ®ŸàŸÑ
                                </button>
                                <button class="admin-btn delete-btn" onclick="rejectWithdrawal('${doc.id}')" style="padding: 8px 15px; font-size: 0.85rem;">
                                    <i class="fas fa-times"></i> ÿ±ŸÅÿ∂
                                </button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading admin withdrawals:', error);
                document.getElementById('adminWithdrawalsTable').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px; color: var(--danger);">ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</td></tr>';
            }
        }

        // Approve withdrawal
        async function approveWithdrawal(withdrawalId) {
            if (!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÇÿ®ŸàŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ® Ÿàÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖÿ®ŸÑÿ∫ÿü')) return;
            
            try {
                const withdrawalRef = firebase.doc(firebase.db, 'withdrawals', withdrawalId);
                
                await firebase.updateDoc(withdrawalRef, {
                    status: 'completed',
                    approvedAt: firebase.serverTimestamp(),
                    approvedBy: currentUser.uid
                });
                
                showNotification('‚úÖ ÿ™ŸÖ ŸÇÿ®ŸàŸÑ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ® ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                loadAdminWithdrawals();
                loadDashboardData();
                
            } catch (error) {
                console.error('Error approving withdrawal:', error);
                showNotification('‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿ®ŸàŸÑ ÿßŸÑÿ≥ÿ≠ÿ®', 'error');
            }
        }

        // Reject withdrawal
        async function rejectWithdrawal(withdrawalId) {
            const reason = prompt('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿ≥ÿ®ÿ® ÿßŸÑÿ±ŸÅÿ∂:');
            if (!reason) return;
            
            try {
                const withdrawalRef = firebase.doc(firebase.db, 'withdrawals', withdrawalId);
                const withdrawalSnap = await firebase.getDoc(withdrawalRef);
                const withdrawal = withdrawalSnap.data();
                
                // Return points to user
                const userRef = firebase.doc(firebase.db, 'users', withdrawal.userId);
                await firebase.updateDoc(userRef, {
                    points: firebase.increment(withdrawal.points)
                });
                
                // Update withdrawal status
                await firebase.updateDoc(withdrawalRef, {
                    status: 'rejected',
                    rejectReason: reason,
                    rejectedAt: firebase.serverTimestamp(),
                    rejectedBy: currentUser.uid
                });
                
                showNotification('‚ùå ÿ™ŸÖ ÿ±ŸÅÿ∂ ÿ∑ŸÑÿ® ÿßŸÑÿ≥ÿ≠ÿ® Ÿàÿ•ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÜŸÇÿßÿ∑', 'warning');
                loadAdminWithdrawals();
                
            } catch (error) {
                console.error('Error rejecting withdrawal:', error);
                showNotification('‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿ∂ ÿßŸÑÿ≥ÿ≠ÿ®', 'error');
            }
        }

        // Load admin settings
        function loadAdminSettings() {
            // Populate settings form
            document.getElementById('pointsPerDollar').value = systemSettings.pointsPerDollar;
            document.getElementById('pointsPerAd').value = systemSettings.pointsPerAd;
            document.getElementById('penaltyPoints').value = systemSettings.penaltyPoints;
            document.getElementById('adDuration').value = systemSettings.adDuration;
            document.getElementById('welcomePoints').value = systemSettings.welcomePoints;
            document.getElementById('referralPoints').value = systemSettings.referralPoints;
        }

        // Save system settings
        async function saveSystemSettings() {
            try {
                const settings = {
                    pointsPerDollar: parseInt(document.getElementById('pointsPerDollar').value),
                    pointsPerAd: parseInt(document.getElementById('pointsPerAd').value),
                    penaltyPoints: parseInt(document.getElementById('penaltyPoints').value),
                    adDuration: parseInt(document.getElementById('adDuration').value),
                    welcomePoints: parseInt(document.getElementById('welcomePoints').value),
                    referralPoints: parseInt(document.getElementById('referralPoints').value),
                    updatedAt: firebase.serverTimestamp(),
                    updatedBy: currentUser.uid
                };
                
                // Validate
                if (settings.pointsPerDollar < 1000 || 
                    settings.pointsPerAd < 10 || 
                    settings.penaltyPoints < 1 || 
                    settings.adDuration < 10 ||
                    settings.welcomePoints < 0 ||
                    settings.referralPoints < 0) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÇŸäŸÖ ÿµÿ≠Ÿäÿ≠ÿ© ŸÅŸä ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ', 'warning');
                    return;
                }
                
                // Save to database
                const settingsRef = firebase.doc(firebase.db, 'settings', 'system');
                await firebase.setDoc(settingsRef, settings, { merge: true });
                
                // Update local settings
                systemSettings = settings;
                
                showNotification('‚úÖ ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'error');
            }
        }

        // Load system settings
        async function loadSystemSettings() {
            try {
                const settingsRef = firebase.doc(firebase.db, 'settings', 'system');
                const settingsSnap = await firebase.getDoc(settingsRef);
                
                if (settingsSnap.exists()) {
                    systemSettings = { ...systemSettings, ...settingsSnap.data() };
                }
                
            } catch (error) {
                console.error('Error loading system settings:', error);
            }
        }

        // Load admin reports
        async function loadAdminReports() {
            try {
                // Get total users
                const usersQuery = firebase.query(firebase.collection(firebase.db, 'users'));
                const usersSnapshot = await firebase.getDocs(usersQuery);
                
                // Get today's watches
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                const watchesQuery = firebase.query(
                    firebase.collection(firebase.db, 'ad_watches'),
                    firebase.where('timestamp', '>=', today),
                    firebase.where('timestamp', '<', tomorrow)
                );
                const watchesSnapshot = await firebase.getDocs(watchesQuery);
                
                // Get total withdrawals
                const withdrawalsQuery = firebase.query(firebase.collection(firebase.db, 'withdrawals'));
                const withdrawalsSnapshot = await firebase.getDocs(withdrawalsQuery);
                
                // Calculate total revenue
                let totalRevenue = 0;
                usersSnapshot.forEach(doc => {
                    const user = doc.data();
                    totalRevenue += user.totalEarned || 0;
                });
                
                // Update UI
                document.getElementById('reportTotalUsers').textContent = usersSnapshot.size;
                document.getElementById('reportTodayWatches').textContent = watchesSnapshot.size;
                document.getElementById('reportTotalWithdrawals').textContent = withdrawalsSnapshot.size;
                document.getElementById('reportSystemRevenue').textContent = `$${totalRevenue.toFixed(2)}`;
                
            } catch (error) {
                console.error('Error loading admin reports:', error);
            }
        }

        // Export report
        function exportReport(type) {
            // In a real app, generate and download CSV/Excel file
            showNotification(`ÿ™ÿ∑ŸàŸäÿ± ŸÇÿßÿØŸÖ: ÿ™ÿµÿØŸäÿ± ÿ™ŸÇÿ±Ÿäÿ± ${type}`, 'info');
        }

        // Show ad modal (for adding/editing ads)
        function showAdModal(adId = null) {
            // In a real app, show modal for adding/editing ads
            showNotification('ÿ™ÿ∑ŸàŸäÿ± ŸÇÿßÿØŸÖ: ÿ•ÿ∂ÿßŸÅÿ©/ÿ™ÿπÿØŸäŸÑ ÿ•ÿπŸÑÿßŸÜ', 'info');
        }

        // Edit ad
        function editAd(adId) {
            showAdModal(adId);
        }

        // Delete ad
        async function deleteAd(adId) {
            if (!confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿπŸÑÿßŸÜÿü')) return;
            
            try {
                await firebase.deleteDoc(firebase.doc(firebase.db, 'ads', adId));
                showNotification('‚úÖ ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ•ÿπŸÑÿßŸÜ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                loadAdminAds();
                loadAds();
            } catch (error) {
                console.error('Error deleting ad:', error);
                showNotification('‚ùå ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ•ÿπŸÑÿßŸÜ', 'error');
            }
        }

        // Generate referral code
        function generateReferralCode(email) {
            const base = email.split('@')[0] + Date.now().toString();
            let hash = 0;
            for (let i = 0; i < base.length; i++) {
                hash = ((hash << 5) - hash) + base.charCodeAt(i);
                hash = hash & hash;
            }
            return 'REF' + Math.abs(hash).toString(36).toUpperCase().substring(0, 8);
        }

        // Handle sign out
        async function handleSignOut() {
            try {
                await firebase.signOut(firebase.auth);
                currentUser = null;
                userData = null;
                isAdmin = false;
                showLoginPage();
                showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            } catch (error) {
                console.error('Sign out error:', error);
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨', 'error');
            }
        }

        // Show loading
        function showLoading() {
            document.getElementById('loadingScreen').style.display = 'flex';
            document.getElementById('loadingScreen').style.opacity = '1';
        }

        // Hide loading
        function hideLoading() {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 300);
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const messageDiv = document.getElementById('notificationMessage');
            
            if (!notification || !messageDiv) return;
            
            // Set type
            notification.className = `notification ${type}`;
            
            // Set icon based on type
            const icon = notification.querySelector('.notification-icon i');
            if (icon) {
                if (type === 'success') {
                    icon.className = 'fas fa-check-circle';
                } else if (type === 'error') {
                    icon.className = 'fas fa-exclamation-circle';
                } else if (type === 'warning') {
                    icon.className = 'fas fa-exclamation-triangle';
                } else {
                    icon.className = 'fas fa-info-circle';
                }
            }
            
            // Set message
            messageDiv.textContent = message;
            notification.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // Add referral code from URL if present
        function checkReferralCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref');
            if (ref) {
                localStorage.setItem('referralCode', ref);
            }
        }

        // Check referral code on page load
        checkReferralCode();

    </script>
</body>
    </html>
